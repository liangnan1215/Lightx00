# Light x00 详细设计文档
By Trap x00

# 0. 更新日志

| 修改人员 | 日期         | 变更原因  | 版本号  |
| ---- | ---------- | ----- | ---- |
| 陈俊达  | 2017/10/29 | 完成模板。 | V0.1 |
| 张凌哲  | 2017/10/30 | 整合文档。 | V1.0 |

# 1. 引言

## 1.1 编制目的

本报告详细完成灯具照明行业进销存系统的详细设计，达到指导后续软件构造的目的，同时实现和测试人员及用户的沟通。

本报告面向开发人员、测试人员及最终用户而编写，是了解系统的导航。

## 1.2 产品概述

参考灯具照明行业进销存系统用例文档和灯具照明行业进销存系统软件规格说明中对产品的概括描述。

## 1.3 体系结构设计概述

参考进销存系统需求文档对体系结构设计的概述。

# 2.结构视角

## 2.1 展示层的分解

展示层开发包图、模块职责等请参考体系结构描述文档5.2节。

### 2.1.1 loginui包

#### 2.1.1.1 概述

loginui包负责系统登录的用例的UI界面以及响应控制代码。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。


#### 2.1.1.2 整体架构

此包为展示层的一部分，它负责用户登录过程中展示信息以及与用户的交互。它依赖它对应的loginblservice包与bl层进行交互。

#### 2.1.1.3 设计

##### 2.1.1.3.1 设计图

![loginui](/img/设计图/loginui.png)

##### 2.1.1.3.2 各个类的职责

| 类名                | 职责            |
| ----------------- | ------------- |
| LoginUiController | 负责登录界面的展示和功能。 |

##### 2.1.1.3.3 内部类的接口规范

**LoginUiController**

需要的接口

| 接口名称                                     | 服务名  |
| ---------------------------------------- | ---- |
| `loginblservice.LoginBlService.login(String username, String password)` | 登录。  |

### 2.1.2 inventoryui包

#### 2.1.2.1 概述

inventoryui包负责库存管理相关等功能的UI的展示和功能实现。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.1.2.2 整体结构

此包为展示层的一部分，它负责展示信息以及与用户的交互。它依赖它对应的inventoryblservice包与bl层进行交互。

#### 2.1.2.3 设计

##### 2.1.2.3.1 设计图

![inventoryui](/img/设计图/inventoryui.png)

##### 2.1.2.3.2 各个类的职责

| 类名                           | 职责                                   |
| ---------------------------- | ------------------------------------ |
| InventoryCheckUiController   | 负责库存查看界面的展示和功能。                      |
| InventoryGiftUiController    | 负责商品赠送界面的展示和功能。                      |
| InventoryWarningUiController | 负责库存监控界面的展示和功能。                      |
| InventoryBillInfoUi          | 负责实现为其他包提供查询获取报损、报溢、报警、赠送单据界面的展示和功能。 |
| PurchaseBillUiController       | 负责制定进货单界面的展示和功能。   |
| PurchaseRefundBillUiController | 负责制定进货退货单界面的展示和功能。 |

##### 2.1.2.3.3 内部类的接口规范

**InventoryCheckUiController**

需要的接口

| 接口名称                                     | 服务名         |
| ---------------------------------------- | ----------- |
| `inventoryblservice.InventoryCheckBlService.check(Date beginTime, Date endTime)` | 提供时间段内库存变化。 |
| `inventoryblservice.InventoryCheckBlService.picture()` | 提供当日库存快照。   |
| `inventoryblservice.InventoryCheckBlService.export(File newfile)` | 导出Excel。    |

**InventoryGiftUiController**

需要的接口

| 接口名称                                     | 服务名           |
| ---------------------------------------- | ------------- |
| `inventoryblservice.InventoryGiftBlService.getGift(Date time); | 提供满足促销条件的赠送单。 |
| `InventoryGiftBlService.getId`           | 得到ID。         |
| `inventoryblservice.InventoryGiftBlService.getAllCommodity(); | 选择商品。         |
| `inventoryblservice.InventoryGiftBlService.submit(InventoryGiftVo inventoryGiftVo)` | 提交完成赠送单。      |

**InventoryWarningUiController**

提供的接口

| 接口名称                             | 语法                                       | 前置条件            | 后置条件        |
| -------------------------------- | ---------------------------------------- | --------------- | ----------- |
| ContinueWritable.continueWriting | `public InventoryWarningUiController continueWriting(InventoryBillVo bill);` | 输入有效的用于继续填写的单据。 | 初始化传入单据的内容。 |

需要的接口

| 接口名称                                     | 服务名     |
| ---------------------------------------- | ------- |
| `inventoryblservice.InventoryWarningBlService.submit(InventoryBillVo bill)` | 提交单据。   |
| `inventoryblservice.InventoryWarningBlService.saveAsDraft(InventoryBillVo bill)` | 保存草稿。   |
| `inventoryblservice.InventoryWarningBlService.modify(CommodityVo commodity，double modifyWarning)` | 修改警戒值。  |
| `inventoryblservice.InventoryWarningBlService.getCurrentBill()` | 得到现有单据。 |
| `inventoryblservice.InventoryWarningBlService.query(InventoryBillQueryVo inventoryBillQueryVo)` | 查询单据。   |
| `inventoryblservice.InventoryWarningBlService.getId()` | 提供ID。   |
| `inventoryblservice.InventoryWarningBlService.getAllCommodity()` | 提供商品。   |

**PurchaseBillUiController**

提供的接口

| 接口名称                             | 语法                                       | 前置条件        | 后置条件        |
| -------------------------------- | ---------------------------------------- | ----------- | ----------- |
| ContinueWritable.continueWriting | `public PurchaseBillUiController continueWriting(PurchaseBillVo bill);` | 需要继续填写单据信息。 | 初始化传入单据的内容。 |

需要的接口

| 接口名称                                     | 服务名       |
| ---------------------------------------- | --------- |
| `clientui.ClientInfoUi.showClientSelectDialog() ` | 选择客户。     |
| `commodity.CommodityInfoUi.showCommoditySelectDialog() ` | 选择商品。     |
| `inventorybl.PurchaseBillBlService.submit(PurchaseBillVo purchaseBill);` | 提交表单。     |
| `inventorybl.PurchaseBillBlService.saveAsDraft(PurchaseBillVo purchaseBill);` | 保存草稿。     |
| `inventorybl.PurchaseBillBlService.getId(); ` | 提供新单据的ID。 |

**PurchaseRefundBillUiController**

提供的接口

| 接口名称                             | 语法                                       | 前置条件        | 后置条件        |
| -------------------------------- | ---------------------------------------- | ----------- | ----------- |
| ContinueWritable.continueWriting | `public PurchaseRefundBillUiController continueWriting(PurchaseRefundBillUiController bill);` | 需要继续填写单据信息。 | 初始化传入单据的内容。 |

需要的接口

| 接口名称                                     | 服务名       |
| ---------------------------------------- | --------- |
| `clientui.ClientInfoUi.showClientSelectDialog() ` | 选择客户。     |
| `commodity.CommodityInfoUi.showCommoditySelectDialog() ` | 选择商品。     |
| `inventorybl.PurchaseRefundBillBlService.submit(PurchaseRefundBillVo purchaseBill);` | 提交表单。     |
| `inventorybl.PurchaseRefundBillBlService.saveAsDraft(PurchaseRefundBillVo purchaseBill);` | 保存草稿。     |
| `inventorybl.PurchaseRefundBillBlService.getId(); ` | 提供新单据的ID。 |

##### 2.1.6.3.4 展示层的动态模型

下图为填写进货单时的PurchaseBillVo对象的状态图。

![进货单状态图](../../img/顺序图/进货单状态图.png)

下图为填写进货退货单时的PurchaseRefundBillVo对象的状态图。

![进货退货单状态图](../../img/顺序图/进货退货单状态图.png)

### 2.1.3 saleui包

#### 2.1.3.1 概述

saleui包负责进货销售人员与销售相关的用例（制定销售单、制定销售退货单）的UI界面以及响应控制代码。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.1.3.2 整体结构

此包为展示层的一部分，它负责展示信息以及与用户的交互。它依赖它对应的saleblservice包与bl层进行交互。由于它有填写信息的用例，为了实现草稿箱、通知以及红冲功能，它还需要实现ContinueWritable接口。

#### 2.1.3.3 设计

##### 2.1.3.3.1 设计图

![saleui](../../img/设计图/saleui.png)

##### 2.1.3.3.2 各个类的职责

| 类名                         | 职责                 |
| -------------------------- | ------------------ |
| SaleBillUiController       | 负责制定销售单界面的展示和功能。   |
| SaleRefundBillUiController | 负责制定销售退货单界面的展示和功能。 |

##### 2.1.3.3.3 内部类的接口规范

**SaleBillUiController**

提供的接口

| 接口名称                             | 语法                                       | 前置条件        | 后置条件        |
| -------------------------------- | ---------------------------------------- | ----------- | ----------- |
| ContinueWritable.continueWriting | `public SaleBillUiController continueWriting(SaleBillVo bill);` | 需要继续填写单据信息。 | 初始化传入单据的内容。 |

需要的接口

| 接口名称                                     | 服务名        |
| ---------------------------------------- | ---------- |
| `clientui.ClientInfoUi.showClientSelectDialog() ` | 选择客户。      |
| `commodity.CommodityInfoUi.showCommoditySelectDialog() ` | 选择商品。      |
| `salebl.SaleBillBlService.submit(SaleBillVO saleBill);` | 提交表单。      |
| `salebl.SaleBillBlService.saveAsDraft(SaleBillVO saleBill);` | 保存草稿。      |
| `salebl.SaleBillBlService.getId(); `     | 提供新单据的ID。  |
| `promotionbl.getPromotion(SaleBillVo saleBill); ` | 提供可用的销售策略。 |

**SaleRefundBillUiController**

提供的接口

| 接口名称                             | 语法                                       | 前置条件        | 后置条件        |
| -------------------------------- | ---------------------------------------- | ----------- | ----------- |
| ContinueWritable.continueWriting | `public SaleRefundBillUiController continueWriting(SaleRefundBillVo bill);` | 需要继续填写单据信息。 | 初始化传入单据的内容。 |

需要的接口

| 接口名称                                     | 服务名       |
| ---------------------------------------- | --------- |
| `clientui.ClientInfoUi.showClientSelectDialog() ` | 选择客户。     |
| `commodity.CommodityInfoUi.showCommoditySelectDialog() ` | 选择商品。     |
| `salebl.SaleRefundBillBlService.submit(SaleRefundBillVO saleRefundBill);` | 提交表单。     |
| `salebl.SaleRefundBillBlService.saveAsDraft(saleRefundBill saleBill);` | 保存草稿。     |
| `salebl.SaleRefundBillBlService.getId(); ` | 提供新单据的ID。 |

##### 2.1.3.3.4 展示层的动态模型

下图为填写销售单时的SaleBillVo对象的状态图。

![销售单状态图](../../img/顺序图/销售单状态图.png)

下图为填写销售退货单时的SaleRefundBillVo对象的状态图。

![销售退货单状态图](../../img/顺序图/销售退货单状态图.png)

### 2.1.4 commodityui包

#### 2.1.4.1 概述

commoditybl包负责库存管理人员商品管理、商品分类管理的的UI界面以及响应控制代码。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.1.4.2 整体结构

此包为展示层的一部分，它负责展示信息以及与用户的交互。它依赖它对应的commodityblservice包与bl层进行交互。

#### 2.1.4.3 设计

##### 2.1.4.3.1 设计图

![commodityui](/img/设计图/commodityui.png)

##### 2.1.4.3.2 各个类的职责

| 类名                        | 职责                   |
| ------------------------- | -------------------- |
| CommodityUiController     | 负责商品管理界面的展示和功能。      |
| CommoditySortUiController | 负责商品分类管理界面的展示和功能。    |
| CommodityInfoUi           | 提供给其他商品及其分类界面的展示和功能。 |

##### 2.1.4.3.3 内部类的接口规范

**CommodityUiController**

需要的接口

| 接口名称                                     | 服务名    |
| ---------------------------------------- | ------ |
| `commodityblservice.GoodsManagementBlService.add(CommodityVo newCommodity)` | 提交新商品。 |
| `commodityblservice.GoodsManagementBlService.modify(CommodityVo commodity)` | 修改商品。  |
| `commodityblservice.GoodsManagementBlService.query(CommdoityQueryVo commodityQueryVo)` | 查询商品   |
| `commodityblservice.GoodsManagementBlService.delete(CommodityVo commodity)` | 删除商品。  |

**CommoditySortUiController**

需要的接口

| 接口名称                                     | 服务名       |
| ---------------------------------------- | --------- |
| `commodityblservice.ProductManagementBlService.add(CommoditySortVo newSort,CommoditySortVo parentSort)` | 提交新分类。    |
| `commodityblservice.ProductManagementBlService.modify(CommoditySortVo sort)` | 修改分类。     |
| `commodityblservice.ProductManagementBlService.query(CommoditySortQuerVo commoditySortQueryVo)` | 查询分类信息。   |
| `commodityblservice.ProductManagementBlService.delete(CommoditySortVo sort)` | 删除分类。     |
| `commodityblservice.ProductManagementBlService.display(); | 显示所有父类。   |
| `commodityblservice.ProductManagementBlService.display(CommoditySortVo commoditySort)` | 显示父类下的子类。 |

### 2.1.5 clientui包

#### 2.1.5.1 概述

clientui包负责进货销售人员管理客户的用例的UI界面以及响应控制代码。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.1.5.2 整体结构

此包为展示层的一部分，它负责展示信息以及与用户的交互。它依赖它对应的clientblservice包与bl层进行交互。由于它有填写信息的用例，为了实现草稿箱、通知功能，它还需要实现ContinueWritable接口。

#### 2.1.5.3 设计

##### 2.1.5.3.1 设计图

![clientui](../../img/设计图/clientui.png)

##### 2.1.5.3.2 各个类的职责

| 类名                 | 职责              |
| ------------------ | --------------- |
| ClientUiController | 负责管理客户界面的展示和功能。 |

##### 2.1.5.3.3 内部类的接口规范

**ClientUiController**

提供的接口

| 接口名称                                | 语法                                       | 前置条件        | 后置条件                           |
| ----------------------------------- | ---------------------------------------- | ----------- | ------------------------------ |
| ContinueWritable.continueWriting    | `public ClientUiController continueWriting(ClientVo bill);` | 需要继续填写客户信息。 | 初始化传入客户信息的内容。                  |
| ClientInfoUi.showClientSelectDialog | `public ClientVo showClientSelectDialog();` | 需要选择客户。     | 初始化一个选择客户对话框（包括模糊搜索功能和所有客户信息）。 |

需要的接口

| 接口名称                                     | 服务名       |
| ---------------------------------------- | --------- |
| `clientblservice.ClientBlService.query(String query);` | 查询客户。     |
| `clientblservice.ClientBlService.saveAsDraft(ClientVo client);` | 保存草稿      |
| `clientblservice.ClientBlService.getId(); ` | 提供新客户的ID。 |
| `clientblservice.ClientBlService.add(ClientVo client);` | 添加客户。     |
| `clientblservice.ClientBlService.delete(ClientVo[] client);` | 客户非空。     |

##### 2.1.5.3.4 展示层的动态模型

如下图所示的状态图描述了ClientVo对象的生存期间的状态序列、引起转移的事件，以及因转移而伴随的动作。
随着getId的方法被UI调用，ClientVo自动填入新的ID，进入正在填写状态，如果填写完成，就可以i进入审查状态，当审查完成后提交，ClientVo就可以进入被提交状态。

![填写客户信息状态图](../../img/顺序图/填写客户信息状态图.png)

### 2.1.6 financeui包

#### 2.1.6.1 概述

financeui包负责财务人员除了银行账户管理外的用例（制定收款单、制定付款单、制定现金费用单、查看经营情况表、查看经营历程表、查看销售情况表、红冲以及期初建账）的UI界面以及响应控制代码。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.1.6.2 整体结构

此包为展示层的一部分，它负责展示信息以及与用户的交互。它依赖它对应的financeblservice包与bl层进行交互。由于它有填写单据的用例，为了实现草稿箱、通知以及红冲功能，它还需要实现ContinueWritable接口。同时，填写单据的用例中需要选择客户，它还依赖clientui包所提供的选择客户的接口。

#### 2.1.6.3 设计

##### 2.1.6.3.1 设计图

![financeui](/img/设计图/financeui.png)


##### 2.1.6.3.2 各个类的职责

| 类名                         | 职责                         |
| -------------------------- | -------------------------- |
| PaymentBillUiController    | 负责管理填写付款单界面的展示和功能。         |
| ReceivalBillUiController   | 负责管理填写收款单界面的展示和功能。         |
| CashBillUiController       | 负责管理填写现金费用单界面的展示和功能。       |
| SystemSnapshotUiController | 负责管理期初建账界面的展示和功能。          |
| SaleDetailUiController     | 负责管理销售明细表界面的展示和功能。         |
| TradeHistoryUiController   | 负责管理经营历程表界面的展示和功能（包括红冲功能）。 |
| TradeSituationUiController | 负责管理经营情况表界面的展示和功能。         |

##### 2.1.6.3.3 内部类的接口规范

**PaymentBillUiController**

提供的接口

| 接口名称                             | 语法                                       | 前置条件           | 后置条件        |
| -------------------------------- | ---------------------------------------- | -------------- | ----------- |
| ContinueWritable.continueWriting | `public PaymentBillUiController continueWriting(PaymentBillVo bill);` | 输入有效的用于继续填写单据。 | 初始化传入单据的内容。 |

需要的接口

| 接口名称                                     | 服务名        |
| ---------------------------------------- | ---------- |
| `bankaccountui.BankAccountInfoUi.showBankAccountSelectDialog()` | 选择银行账户。    |
| `clientui.ClientInfoUi.showClientSelectDialog() ` | 选择客户。      |
| `financeblservice.PaymentBillBlService.submit(PaymentBillVo bill)` | 提交单据。      |
| `financeblservice.PaymentBillBlService.saveAsDraft(PaymentBillVo bill)` | 保存草稿。      |
| `financeblservice.PaymentBillBlService.getId()` | 获得当前单据的ID。 |


**ReceivalBillUiController**

提供的接口

| 接口名称                             | 语法                                       | 前置条件            | 后置条件        |
| -------------------------------- | ---------------------------------------- | --------------- | ----------- |
| ContinueWritable.continueWriting | `public ReceivalBillUiController continueWriting(ReceivalBillVo bill);` | 输入有效的用于继续填写的单据。 | 初始化传入单据的内容。 |

需要的接口

| 接口名称                                     | 服务名        |
| ---------------------------------------- | ---------- |
| `bankaccountui.BankAccountInfoUi.showBankAccountSelectDialog()` | 选择银行账户。    |
| `clientui.ClientInfoUi.showClientSelectDialog() ` | 选择客户。      |
| `financeblservice.ReceivalBillBlService.submit(ReceivalBillVo bill)` | 提交单据。      |
| `financeblservice.ReceivalBillBlService.saveAsDraft(ReceivalBillVo bill)` | 保存草稿。      |
| `financeblservice.ReceivalBillBlService.getId()` | 获得当前单据的ID。 |

**CashBillUiController**

提供的接口

| 接口名称                             | 语法                                       | 前置条件            | 后置条件        |
| -------------------------------- | ---------------------------------------- | --------------- | ----------- |
| ContinueWritable.continueWriting | `public CashBillUiController continueWriting(CashBillVo bill);` | 输入有效的用于继续填写的单据。 | 初始化传入单据的内容。 |

需要的接口

| 接口名称                                     | 服务名        |
| ---------------------------------------- | ---------- |
| `bankaccountui.BankAccountInfoUi.showBankAccountSelectDialog()` | 选择银行账户。    |
| `financeblservice.CashBillBlService.submit(CashBillVo bill)` | 提交单据。      |
| `financeblservice.CashBillBlService.saveAsDraft(CashBillVo bill)` | 保存草稿。      |
| `financeblservice.CashBillBlService.getId() ` | 获得当前单据的ID。 |

**InitialEstablishmentUiController**

提供的接口

| 接口名称                             | 语法                                       | 前置条件           | 后置条件        |
| -------------------------------- | ---------------------------------------- | -------------- | ----------- |
| ContinueWritable.continueWriting | `public InitialEstablishmentUiController continueWriting(SystemSnapshotVo bill);` | 输入有效的用于继续填写的账。 | 初始化传入单据的内容。 |

需要的接口

| 接口名称                                     | 服务名                                      |
| ---------------------------------------- | ---------------------------------------- |
| `financeblservice.InitialEstablishmentBlService.autofill()` | 返回现有系统信息（所有商品信息、单据信息、银行账户信息）。            |
| `financeblservice.InitialEstablishmentBlService.submit(SystemSnapshotVo snapshot)` | 提交账。                                     |
| `financeblservice.InitialEstablishmentBlService.saveAsDraft(SystemSnapshotVo snapshot)` | `public ResultMessage saveAsDraft(SystemSnapshotVo snapshot);` |

**SaleDetailUiController**

需要的接口

| 接口名称                                     | 服务名     |
| ---------------------------------------- | ------- |
| `clientui.ClientInfoUi.showClientSelectDialog() ` | 选择客户。   |
| `adminui.AdminInfoUi.showEmployeeSelectDialog()` | 选择操作员。  |
| `financeblservice.SaleDetailBlService.query(SaleDetailQueryVo query)` | 查询销售情况。 |
| `financeblservice.SaleDetailBlService.export(SaleDetailVo detail)` | 导出报表。   |

**TradeHistoryUiController**

需要的接口

| 接口名称                                     | 服务名          |
| ---------------------------------------- | ------------ |
| `clientui.ClientInfoUi.showClientSelectDialog() ` | 选择客户。        |
| `adminui.AdminInfoUi.showEmployeeSelectDialog()` | 选择操作员。       |
| `financeblservice.TradeHistoryBlService.query(TradeHistoryQueryVo query)` | 查询经营历程。      |
| `financeblservice.TradeHistoryBlService.export(TradeHistoryVo history)` | 查询经营历程。      |
| `helpui.ContinueWritable.continueWriting(T bill)` | 用于红冲时继续填写单据。 |

**TradeSituationUiController**

需要的接口

| 接口名称                                     | 服务名     |
| ---------------------------------------- | ------- |
| `financeblservice.TradeSituationBlService.query(TradeSituationQueryVo query)` | 查询经营情况。 |
| `financeblservice.TradeSituationBlService.export(TradeSituationVo situation)` | 导出。     |

##### 2.1.6.3.4 展示层的动态模型

下图为填写付款单时的PaymentBillVo对象的状态图。其他单据Vo对象同理。

![付款单状态图](/img/状态图/付款单状态图.png)

### 2.1.7 bankaccountui包

#### 2.1.7.1 概述

bankaccountui包负责银行账户管理相关的UI的展示和功能实现。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.1.7.2 整体结构

此包为展示层的一部分，它负责展示信息以及与用户的交互。它依赖它对应的financeblservice包与bl层进行交互。

#### 2.1.7.3 设计

##### 2.1.7.3.1 设计图

![bankaccountui](/img/设计图/bankaccountui.png)

##### 2.1.7.3.2 各个类的职责

| 类名                      | 职责                |
| ----------------------- | ----------------- |
| BankAccountUiController | 负责管理银行账户的展示和功能实现。 |

##### 2.1.7.3.3 内部类的接口规范

**BankAccountUiController**

提供的接口

| 接口名称                                     | 语法                                       | 前置条件 | 后置条件         |
| ---------------------------------------- | ---------------------------------------- | ---- | ------------ |
| BankAccountInfoUi.showBankAccountSelectDialog | `public BankAccountVo[] showBankAccountSelectDialog();` | 无。   | 弹出选择银行账户的窗口。 |

需要的接口

| 接口名称                                     | 服务名     |
| ---------------------------------------- | ------- |
| `bankaccountblservice.BankAccountManagementBlService.add(BankAccountVo newAccount)` | 添加账户信息。 |
| `bankaccountblservice.BankAccountManagementBlService.modify(BankAccountVo newAccount)` | 修改账户信息。 |
| `bankaccountblservice.BankAccountManagementBlService.query(BankAccountQueryVo query)` | 查询账户信息。 |
| `bankaccountblservice.BankAccountManagementBlService.delete(BankAccountVo account)` | 删除账户信息。 |

### 2.1.8 draftui包

#### 2.1.8.1 概述

draftui包负责草稿箱功能的UI界面以及响应控制代码。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.1.8.2 整体架构

此包为展示层的一部分，它负责草稿箱的功能与实现。它依赖它对应的draftblservice与bl层交互以管理草稿数据，也需要其他填写单据UI包的支持以实现继续填写的功能。

#### 2.1.8.3 设计

#### 2.1.8.3.1 设计图

![draftui](/img/设计图/draftui.png)

##### 2.1.8.3.2 各个类的职责


| 类名                | 职责            |
| ----------------- | ------------- |
| DraftUiController | 负责草稿界面的展示和功能。 |

##### 2.1.8.3.3 内部类的接口规范


**DraftUiController**

需要的接口

| 接口名称                                     | 服务名         |
| ---------------------------------------- | ----------- |
| `draftblservice.DraftBlService.update()` | 获得当前用户所有单据。 |
| `draftblservice.DraftBlService.delete(Draftable draft)` | 删除选中单据。     |
| `ContinueWritable.continueWriting(T draft)` | 继续填写所选单据。   |


### 2.1.9 logui包

#### 2.1.9.1 概述

logui包负责查看日志的UI界面以及相应控制代码。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.1.9.2 整体架构

此包为展示层的一部分，它负责草稿箱的功能和实现。它依赖它对应的logblservice与bl层交互以获得日志信息。

#### 2.1.9.3 设计

##### 2.1.9.3.1 设计图

![logui](/img/设计图/logui.png)

##### 2.1.9.3.2 各个类的职责

| 类名              | 职责            |
| --------------- | ------------- |
| LogUiController | 负责日志界面的展示和功能。 |

##### 2.1.9.3.3 内部类的接口规范

**LogUiController**

需要的接口

| 接口名称                                     | 服务名   |
| ---------------------------------------- | ----- |
| `logblservice.LogBlService.query(LogQueryVo query)` | 查询日志。 |

### 2.1.10 notificationui包

#### 2.1.10.1 概念

notificationui包负责通知功能的UI界面以及相应控制代码。具体功能需求和肺功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.1.10.2 整体架构

此包为展示层的一部分，它负责通知的功能和实现。它依赖它对应的notificationblservice层与bl层交互以进行响应操作。同时也需要其他填写单据UI包的支持以实现继续填写的功能。

#### 2.1.10.3 设计

##### 2.1.10.3.1 设计图

![notificationui](/img/设计图/notificationui.png)

##### 2.1.10.3.2 各个类的职责

| 类名                       | 职责            |
| ------------------------ | ------------- |
| NotificationUiController | 负责通知界面的展示和功能。 |

##### 2.1.10.3.3 内部类的接口规范

**NotificationUiController**

需要的接口

| 接口名称                                     | 服务名       |
| ---------------------------------------- | --------- |
| `notificationblservice.NotificationBlService.update(NotificationQueryVo query)` | 更新通知。     |
| `notificationblservice.NotificationBlService.acknowledge(NotificationVo notification)` | 已读通知。     |
| `notificationblservice.NotificationBlService.abandon(NotificationVo notification)` | 丢弃单据通知。   |
| `ContinueWritable.continueWriting(T draft)` | 继续填写所选单据。 |







## 2.2 业务逻辑层的分解

业务逻辑层开发包图、模块职责等请参考体系结构描述文档5.3节。

### 2.2.1 loginbl包

#### 2.2.1.1 概述

loginbl包负责登录功能的业务逻辑实现代码。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.2.1.2 整体架构

此包为业务逻辑层的一部分，它负责业务逻辑的实现。它实现了loginui包所需要的loginblservice的所有接口，并依赖logindataservice包与data层进行交互。它还需要LogService包来实现记录日志的行为。

#### 2.2.1.3 设计

##### 2.2.1.3.1 设计图

![loginbl](/img/设计图/loginbl.png)

##### 2.2.1.3.2 各个类的职责

| 类名                | 职责         |
| ----------------- | ---------- |
| LoginBlController | 负责处理登录的功能。 |

##### 2.2.1.3.3 内部类的接口规范

**LoginBlController**

提供的接口

| 接口名称                                | 语法                                       | 前置条件 | 后置条件          |
| ----------------------------------- | ---------------------------------------- | ---- | ------------- |
| loginblservice.LoginBlService.login | `public EmployeeVo login(String username, String password);` | 无。   | 系统已经登录或者登录失败。 |

需要的接口

| 接口名称                                     | 服务名   |
| ---------------------------------------- | ----- |
| `logindataservice.LoginDataService.login(String username, String password)` | 登录。   |
| `logbl.LogService.log(LogSeverity severity, String content);` | 记录日志。 |

##### 2.2.1.3.4 业务逻辑层的动态模型

下图是登录过程中的顺序图。

![登录](/img/流程图/登录.png)

### 2.2.6 financebl包

#### 2.2.6.1 概述

financeui包负责财务人员除了银行账户管理外的用例（制定收款单、制定付款单、制定现金费用单、查看经营情况表、查看经营历程表、查看销售情况表、红冲以及期初建账）的业务逻辑实现代码。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.2.6.2 整体架构

此包为业务逻辑层的一部分，它负责业务逻辑的实现。它实现了financeui包所需要的financeblservice的所有接口，并依赖financedataservice包与data层进行交互。

#### 2.2.6.3 设计

##### 2.2.6.3.1 设计图

![financebl](/img/设计图/financebl.png)

##### 2.2.6.3.2 各个类的职责

| 类名                         | 职责                       |
| -------------------------- | ------------------------ |
| PaymentBillBlController    | 负责管理付款单的提交、保存草稿以及激活操作。   |
| ReceivalBillBlController   | 负责管理收款单的提交、保存草稿以及激活操作。   |
| CashBillBlController       | 负责管理现金费用单的提交、保存草稿以及激活操作。 |
| SystemSnapshotBlController | 负责管理期初建账的提交、保存草稿以及激活操作。  |
| SaleDetailBlController     | 负责查看销售明细表的功能实现。          |
| TradeHistoryBlController   | 负责经营历程表的功能实现。            |
| TradeSituationBlController | 负责经营情况表的功能实现。            |


##### 2.2.6.3.3 内部类的接口规范

**PaymentBillBlController**

提供的接口

| 接口名称                             | 语法                                       | 前置条件          | 后置条件                                  |
| -------------------------------- | ---------------------------------------- | ------------- | ------------------------------------- |
| PaymentBillBlService.submit      | `public ResultMessage submit(PaymentBillVo bill);` | 单据所有属性有效。     | 单据已经保存到数据库，持久化信息已经保存。                 |
| PaymentBillBlService.saveAsDraft | `public ResultMessage saveAsDraft(PaymentBillVo bill);` | 单据信息非空。       | 保存草稿，持久化信息已经保存。                       |
| PaymentBillBlService.getId       | `public String getId(); `                | 无。            | 获得新单据的ID。                             |
| NotificationActivation.activate  | `public ResultMessage activate(PaymentBillVo bill);` | 单据有效且状态为审批通过。 | 系统修改对应银行账户和客户信息，修改单据状态为已入账，持久化信息已经保存。 |
| NotificationActivation.abandon   | `public ResultMessage abandon(PaymentBillVo bill);` | 单据有效且状态为审批完成。 | 系统修改单据状态为已经废弃，持久化信息已经保存。              |

需要的接口

| 接口名称                                     | 服务名       |
| ---------------------------------------- | --------- |
| `logbl.LogService.log(LogSeverity severity, String content)` | 记录日志。     |
| `draftbl.DraftService.saveAsDraft(PaymentBillVo bill)` | 保存草稿。     |
| `approvalbl.ApprovalRequest.requestApproval(BillVo bill)` | 提交等待审核。   |
| `financedataservice.PaymentBillDataService.submit(PaymentBillPo bill)` | 提交新单据。    |
| `financedataservice.PaymentBillDataService.activate(PaymentBillPo bill) ` | 使单据入账。    |
| `financedataservice.PaymentBillDataService.abandon(PaymentBillPo bill)` | 废弃单据。     |
| `financedataservice.PaymentBillDataService.getId()` | 获得新单据的ID。 |

**ReceivalBillBlController**

提供的接口

| 接口名称                              | 语法                                       | 前置条件          | 后置条件                                  |
| --------------------------------- | ---------------------------------------- | ------------- | ------------------------------------- |
| ReceivalBillBlService.submit      | `public ResultMessage submit(ReceivalBillVo bill);` | 单据所有属性有效。     | 单据已经保存到数据库，持久化信息已经保存。                 |
| ReceivalBillBlService.saveAsDraft | `public ResultMessage saveAsDraft(ReceivalBillVo bill);` | 单据信息非空。       | 保存草稿，持久化信息已经保存。                       |
| ReceivalBillBlService.getId       | `public String getId(); `                | 无。            | 获得新单据的ID。                             |
| NotificationActivation.activate   | `public ResultMessage activate(ReceivalBillVo bill);` | 单据有效且状态为审批通过。 | 系统修改对应银行账户和客户信息，修改单据状态为已入账，持久化信息已经保存。 |
| NotificationActivation.abandon    | `public ResultMessage abandon(ReceivalBillVo bill);` | 单据有效且状态为审批完成。 | 系统修改单据状态为已经废弃，持久化信息已经保存。              |

需要的接口

| 接口名称                                     | 服务名       |
| ---------------------------------------- | --------- |
| `logbl.LogService.log(LogSeverity severity, String content)` | 记录日志。     |
| `draftbl.DraftService.saveAsDraft(ReceivalBillVo bill)` | 保存草稿。     |
| `approvalbl.ApprovalRequest.requestApproval(BillVo bill)` | 提交等待审核。   |
| `financedataservice.ReceivalBillDataService.submit(ReceivalBillPo bill)` | 提交新单据。    |
| `financedataservice.ReceivalBillDataService.activate(ReceivalBillPo bill) ` | 使单据入账。    |
| `financedataservice.ReceivalBillDataService.abandon(ReceivalBillPo bill)` | 废弃单据。     |
| `financedataservice.ReceivalBillDataService.getId()` | 获得新单据的ID。 |

**CashBillBlController**

提供的接口

| 接口名称                            | 语法                                       | 前置条件          | 后置条件                                  |
| ------------------------------- | ---------------------------------------- | ------------- | ------------------------------------- |
| CashBillBlService.submit        | `public ResultMessage submit(CashBillVo bill);` | 单据所有属性有效。     | 单据已经保存到数据库，持久化信息已经保存。                 |
| CashBillBlService.saveAsDraft   | `public ResultMessage saveAsDraft(CashBillVo bill);` | 单据信息非空。       | 保存草稿，持久化信息已经保存。                       |
| CashBillBlService.getId         | `public String getId(); `                | 无。            | 获得新单据的ID。                             |
| NotificationActivation.activate | `public ResultMessage activate(CashBillVo bill);` | 单据有效且状态为审批通过。 | 系统修改对应银行账户和客户信息，修改单据状态为已入账，持久化信息已经保存。 |
| NotificationActivation.abandon  | `public ResultMessage abandon(CashBillVo bill);` | 单据有效且状态为审批完成。 | 系统修改单据状态为已经废弃，持久化信息已经保存。              |

需要的接口

| 接口名称                                     | 服务名       |
| ---------------------------------------- | --------- |
| `logbl.LogService.log(LogSeverity severity, String content)` | 记录日志。     |
| `draftbl.DraftService.saveAsDraft(CashBillVo bill)` | 保存草稿。     |
| `approvalbl.ApprovalRequest.requestApproval(BillVo bill)` | 提交等待审核。   |
| `financedataservice.CashBillDataService.submit(CashBillPo bill)` | 提交新单据。    |
| `financedataservice.CashBillDataService.activate(CashBillPo bill)` | 使单据入账。    |
| `financedataservice.CashBillDataService.abandon(CashBillPo bill)` | 废弃单据。     |
| `financedataservice.CashBillDataService.getId()` | 获得新单据的ID。 |


**InitialEstablishmentBlController**

提供的接口

| 接口名称                                     | 语法                                       | 前置条件      | 后置条件                  |
| ---------------------------------------- | ---------------------------------------- | --------- | --------------------- |
| InitialEstablishmentBlService.submit     | `public ResultMessage submit(SystemSnapshotVo bill);` | 单据所有属性有效。 | 单据已经保存到数据库，持久化信息已经保存。 |
| InitialEstablishmentBlService.saveAsDraft | `public ResultMessage saveAsDraft(SystemSnapshotVo bill);` | 单据信息非空。   | 保存草稿，持久化信息已经保存。       |
| InitialEstablishmentBlService.autofill   | `public SystemSnapshotVo autofill();`    | 无。        | 返回现有系统信息。             |

需要的接口

| 接口名称                                     | 服务名         |
| ---------------------------------------- | ----------- |
| `logbl.LogService.log(LogSeverity severity, String content)` | 记录日志。       |
| `draftbl.DraftService.saveAsDraft(SystemSnapshotVo bill)` | 保存草稿。       |
| `clientbl.queryClient(String query)`     | 查询客户。       |
| `commoditybl.CommodityInfo.getAllCommodity()` | 取得所有商品信息。   |
| `commoditybl.CommodityInfo.getAllCommoditySort()` | 取得所有商品分类信息。 |
| `bankaccountbl.BankAccountInfo.getAllBankAccount()` | 取得所有银行账户信息。 |
| `financedataservice.InitialEstablishmentDataService.submit(SystemSnapshotPo snapshot)` | 提交新单据。      |
| `financedataservice.InitialEstablishmentDataService.getId()` | 获得新单据的ID。   |

**SaleDetailBlController**

提供的接口

| 接口名称                       | 语法                                       | 前置条件                         | 后置条件     |
| -------------------------- | ---------------------------------------- | ---------------------------- | -------- |
| SaleDetailBlService.query  | `public SaleDetailVo query(SaleDetailQueryVo query);` | 输入的query不为空。其中值为null的字段为不限制。 | 返回销售明细表。 |
| SaleDetailBlService.export | `public ResultMessage export(SaleDetailVo detail);` | 表不为空且有效。                     | 导出单据。    |

需要的接口

| 接口名称                                     | 服务名      |
| ---------------------------------------- | -------- |
| `logbl.LogService.log(LogSeverity severity, String content)` | 记录日志。    |
| `salebl.SaleBillInfo.querySaleBill(SaleBillQueryVo query)` | 查询销售单。   |
| `salebl.SaleBillInfo.querySaleRefundBill(SaleBillQueryVo query)` | 查询销售退货单。 |


**TradeHistoryBlController**

提供的接口

| 接口名称                         | 语法                                       | 前置条件                         | 后置条件                         |
| ---------------------------- | ---------------------------------------- | ---------------------------- | ---------------------------- |
| TradeHistoryBlService.query  | `public TradeHistoryVo query(TradeHistoryQueryVo query);` | 输入的query不为空。其中值为null字段的为不限制。 | 返回符合条件的单据。                   |
| TradeHistoryBlService.export | `public ResultMessage export(TradeHistoryVo bills);` | bills参数不为空且有效。               | 导出报表。                        |
| FinanceBillInfo.query        | `public FinanceBillVo[] queryFinanceBill(FinanceBillQueryVo query);` | 无。                           | 返回符合条件的财务单据。若某一条目为null则为无限制。 |

需要的接口

| 接口名称                                     | 服务名          |
| ---------------------------------------- | ------------ |
| `logbl.LogService.log(LogSeverity severity, String content)` | 记录日志。        |
| `financedataservice.TradeHistoryDataService.query(FinanceBillQueryVo query)` | 根据条件查找财务类单据。 |
| `salebl.SaleBillInfo.querySaleBill(SaleBillQueryVo query)` | 查询销售单。       |
| `salebl.SaleBillInfo.querySaleRefundBill(SaleRefundBillQueryVo query)` | 查询销售退货单。     |
| `inventorybl.PurchaseBillInfo.queryPurchaseBill(PurchaseBillQueryVo query)` | 查询进货单。       |
| `inventorybl.PurchaseBillInfo.queryPurchaseRefundBill(PurchaseRefundBillQueryVo query)` | 查询进货退货单。     |
| `inventorybl.InventoryBillInfo.queryInventoryBill(InventoryBillQueryVo query)` | 查询库存类单据。     |

**TradeSituationBlController**


提供的接口

| 接口名称                           | 语法                                       | 前置条件     | 后置条件         |
| ------------------------------ | ---------------------------------------- | -------- | ------------ |
| TradeSituationBlService.query  | `public TradeSituationVo query(Date start, Date end);` | 输入时间段有效。 | 返回时间段内的经营情况。 |
| TradeSituationBlService.export | `public ResultMessage export(TradeSituationVo situation);` | 选定表格非空。  | 导出报表。        |

需要的接口

| 接口名称                                     | 服务名      |
| ---------------------------------------- | -------- |
| `logbl.LogService.log(LogSeverity severity, String content)` | 记录日志。    |
| `salebl.SaleBillInfo.querySaleBill(SaleBillQueryVo query)` | 查询销售单。   |
| `salebl.SaleBillInfo.querySaleRefundBill(SaleRefundBillQueryVo query)` | 查询销售退货单。 |
| `inventorybl.PurchaseBillInfo.queryPurchaseBill(PurchaseBillQueryVo query)` | 查询进货单。   |
| `inventorybl.PurchaseBillInfo.queryPurchaseRefundBill(PurchaseRefundBillQueryVo query)` | 查询进货退货单。 |
| `inventorybl.InventoryBillInfo.queryInventoryBill(InventoryBillQueryVo query)` | 查询库存类单据。 |


##### 2.2.6.3.4 业务逻辑层的动态模型

下图为填写付款单时的顺序图。

![填写付款单](/img/顺序图/填写付款单.png)

下图为填写付款单时被中断保存草稿的顺序图，其他单据保存草稿同理。

![填写付款单保存草稿](/img/顺序图/填写付款单保存草稿.png)

下图为填写收款单时的顺序图。

![填写收款单](/img/顺序图/填写收款单.png)

下图为填写现金费用单时的顺序图。

![填写现金费用单](/img/顺序图/填写现金费用单.png)

下图为期初建账时的顺序图。

![期初建账](/img/顺序图/期初建账.png)

下图为查看经营历程表的顺序图。

![查看经营历程表](/img/顺序图/查看经营历程表.png)

由于本包会对外提供查询财务单据的接口，此用例顺序图如下。

![BL层查询财务单据信息](/img/顺序图/BL层查询财务单据信息.png)

下图为查看销售明细表的顺序图。

![查看销售明细表](/img/顺序图/查看销售明细表.png)

下图为查看经营情况表的顺序图。

![查看经营情况表](/img/顺序图/查看经营情况表.png)




### 2.2.7 bankaccountbl包

#### 2.2.7.1 概述

bankaccountbl包负责银行账户管理的的业务逻辑实现代码。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.2.7.2 整体架构

此包为业务逻辑层的一部分，它负责业务逻辑的实现。它实现了bankaccountui包所需要的bankaccountblservice的所有接口，并依赖bankaccountdataservice包与data层进行交互。它同时公开了BankAccountInfo接口用于给其他bl提供银行账户信息。

#### 2.2.7.3 设计

##### 2.2.7.3.1 设计图

![bankaccountui](/img/设计图/bankaccountbl.png)

##### 2.2.7.3.2 各个类的职责

| 类名                      | 职责               |
| ----------------------- | ---------------- |
| BankAccountBlController | 负责管理银行账户管理功能的实现。 |

##### 2.2.7.3.3 内部类的接口规范

**BankAccountBlController**

提供的接口

| 接口名称                                  | 语法                                       | 前置条件                  | 后置条件                   |
| ------------------------------------- | ---------------------------------------- | --------------------- | ---------------------- |
| BankAccountManagementBlService.add    | `public ResultMessage add(BankAccountVo newAccount);` | 新账户信息合法且无冲突，用户具有最高权限。 | 新银行账户信息已经添加，持久化信息已经保存。 |
| BankAccountManagementBlService.modify | `public ResultMessage modify(BankAccountVo newAccount);` | 新账户信息合法且无冲突，用户具有最高权限。 | 银行账户信息已经修改，持久化信息已经保存。  |
| BankAccountManagementBlService.query  | `public BankAccountVo[] query(BankAccountQueryVo query);` | 查询条件合法。               | 返回符合查询条件的数据。           |
| BankAccountManagementBlService.delete | `public ResultMessage delete(BankAccountVo account);` | 选择的账户合法，用户具有最高权限。     | 选定账户信息已经删除，持久化信息已经保存。  |
| BankAccountInfo.queryBankAccount      | `public BankAccountVo[] queryBankAccount(BankAccoutQueryVo query);` | 无。                    | 返回符合查询条件的数据。           |


需要的接口


| 接口名称                                     | 服务名            |
| ---------------------------------------- | -------------- |
| `bankaccountdataservice.BankAccountManagementDataService.query(BankAccountQueryVo query);` | 根据ID和/或名称查询账户。 |
| `bankaccountdataservice.BankAccountManagementDataService.add(BankAccountPo account);` | 添加账户。          |
| `bankaccountdataservice.BankAccountManagementDataService.modify(BankAccountPo account);` | 修改账户信息。        |
| `bankaccountdataservice.BankAccountManagementDataService.delete(BankAccountPo account);` | 删除账户信息。        |
| `logbl.LogService.log(LogSeverity severity, String content)` | 记录日志。          |

##### 2.2.7.3.4 业务逻辑层的动态模型

下图为新增银行账户的顺序图。

![增加银行账户](/img/顺序图/增加银行账户.png)

下图为修改银行账户的顺序图。

![修改银行账户](/img/顺序图/修改银行账户.png)

下图为删除银行账户的顺序图。

![删除银行账户](/img/顺序图/删除银行账户.png)

下图为查询银行账户的顺序图。

![查询银行账户](/img/顺序图/查询银行账户.png)

由于本包会对外提供查询银行账户接口，此功能实现顺序图如下。

![BL层查询银行账户](/img/顺序图/BL层查询银行账户.png)


### 2.2.8 draftbl包

#### 2.2.8.1 概述

draftbl包包括了草稿功能的业务逻辑实现代码。具体功能需求和肺功能需求可参见需求规格说明文档和体系结构说明文档。

#### 2.2.8.2 整体架构

此包为业务逻辑层的一个部分，它负责业务逻辑的实现。它实现了draftui包所需要的draftblservice的所有接口，并依赖draftdataservice包与data层进行交互。它还需要LogService来实现记录日志的行为。它还提供DraftService接口以便其他单据类实现保存草稿功能。

#### 2.2.8.3 设计

##### 2.2.8.3.1 设计图

![draftbl](/img/设计图/draftbl.png)

##### 2.2.8.3.2 各个类的职责

| 类名                | 职责           |
| ----------------- | ------------ |
| DraftBlController | 负责草稿实现相关的功能。 |

##### 2.2.8.3.3 内部类的接口规范

**DraftBlController**

提供的接口

| 接口名称                                 | 语法                                       | 前置条件           | 后置条件             |
| ------------------------------------ | ---------------------------------------- | -------------- | ---------------- |
| draftblservice.DraftBlService.update | `public Draftable[] update(DraftQueryVo query);` | 无。             | 获得当前用户已经保存的草稿。   |
| draftblservice.DraftBlService.delete | `public ResultMessage delete(Draftable bill);` | 选择的单据有效并状态是草稿。 | 将草稿删除，持久化信息已经保存。 |





需要的接口

| 接口名称                                     | 服务名   |
| ---------------------------------------- | ----- |
| `draftdataservice.DraftDataService.update(DraftQueryVo query)` | 更新草稿。 |
| `draftdataservice.DraftDataService.delete(Draftable bill)` | 删除草稿。 |

##### 2.2.8.3.4 业务逻辑层的动态模型

下图是继续填写草稿例子中的顺序图。
![继续填写草稿](/img/流程图/继续填写草稿.png)

下图是保存草稿的接口实现的顺序图。
![保存草稿](/img/流程图/保存草稿.png)

下图是删除草稿的顺序图。
![删除草稿](/img/流程图/删除草稿.png)

下图是BL层公开的增加草稿的接口实现的顺序图。
![BL层增加草稿](/img/流程图/BL层增加草稿.png)

### 2.2.9 logbl包

#### 2.2.9.1 概述

logbl包包括了日志功能的业务逻辑实现代码。具体功能需求和肺功能需求可参见需求规格说明文档和体系结构说明文档。

#### 2.2.9.2 整体架构

此包为业务逻辑层的一个部分，它负责业务逻辑的实现。它实现了logui包所需要的logblservice的所有接口，并依赖logdataservice包与data层进行交互。它提供了LogService接口来实现记录日志的行为。

#### 2.2.9.3 设计

##### 2.2.9.3.1 设计图

![logbl](/img/设计图/logbl.png)

##### 2.2.9.3.2 各个类的职责


| 类名              | 职责               |
| --------------- | ---------------- |
| LogBlController | 负责日志相关的业务逻辑实现代码。 |

##### 2.2.9.3.3 内部类的接口规范

**LogBlController**

提供的接口

| 接口名称                               | 语法                                       | 前置条件       | 后置条件            |
| ---------------------------------- | ---------------------------------------- | ---------- | --------------- |
| logbl.LogService.log               | `public ResultMessage log(LogSeverity severity, String content);` | content非空。 | 日志保存，持久化信息已经保存。 |
| logblservice.LogBlService.queryLog | `public LogVo[] query(LogQueryVo query);` | 无。         | 返回符合条件的日志。      |

需要的接口

| 接口名称                                     | 服务名   |
| ---------------------------------------- | ----- |
| `logdataservice.LogDataService.query(LogQueryVo query)` | 查询日志。 |
| `logdataservice.LogDataService.log(LogSeverity severity, String content)` | 记录日志。 |

##### 2.2.9.3.4 业务逻辑层的动态模型

下图是查看日志的顺序图。
![查看日志](/img/流程图/查看日志.png)

下图是记录日志的接口实现图。
![记录日志](/img/流程图/记录日志.png)




### 2.2.10 notificationbl包

#### 2.2.10.1 概述

notificationbl包负责登录功能的业务逻辑实现代码。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.2.10.2 整体架构

此包为业务逻辑层的一个部分，它负责业务逻辑的实现。它实现了notificationui包所需要的notificationblservice接口。它还需要NotificationActivation接口以实现单据入账和丢弃的操作，以及LogService进行记录日志的操作。

#### 2.2.10.3 设计

##### 2.2.10.3.1 设计图

![notificationbl](/img/设计图/notificationbl.png)

##### 2.2.10.3.2 各个类的职责


| 类名                       | 职责               |
| ------------------------ | ---------------- |
| NotificationBlController | 负责通知相关功能的业务逻辑实现。 |

##### 2.2.10.3.3 内部类的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件                      | 后置条件                |
| ---------------------------------------- | ---------------------------------------- | ------------------------- | ------------------- |
| notificationblservice.NotificationBlService.update | `public NotificationVo[] update(NotificationQueryVo query);` | 无。                        | 返回当前用户已有的通知。        |
| notificationblservice.NotificationBlService.acknowledge | `public ResultMessage acknowledge(NotificationVo notification);` | 参数notification有效非null。    | 删除已有的通知，持久化信息已经保存。  |
| notificationblservice.NotificationBlService.abandon | `public ResultMessage abandon(NotificationVo notification);` | notification为已经审批结束的单据通知。 | 单据被标记为废弃，持久化信息已经保存。 |
| NotificationService.addNotification      | `public ResultMessage addNotification(NotificationVo notification)` | notification有效。           | 增加通知。               |

需要的接口

| 接口名称                                     | 服务名   |
| ---------------------------------------- | ----- |
| `notificationdataservice.NotificationDataService.update(NotificationQueryVo query)` | 更新通知。 |
| `notificationdataservice.NotificationDataService.addNotification(NotificationVo notification)` | 增加通知。 |
| `notificationdataservice.NotificationDataService.acknowledge(NotificationPo notification)` | 已读通知。 |
| `logbl.LogService.log(LogSeverity severity, String content)` | 记录日志。 |
| `NotificationActivation.activate(BillVo bill)` | 入账单据。 |
| `NotificationActivation.abandon(BillVo bill)` | 丢弃单据。 |

##### 2.2.10.3.4 业务逻辑层的动态模型

下图是已读通知的顺序图。
![通知已读通知](/img/流程图/通知已读通知.png)

下图是丢弃单据的顺序图。
![通知丢弃单据](/img/流程图/通知丢弃单据.png)

下图是修改单据的顺序图。
![通知修改单据](/img/流程图/通知修改单据.png)





## 2.3 数据层的分解

数据层开发包图、模块职责等请参考体系结构描述文档5.3节。

### 2.3.1 logindata包

#### 2.3.1.1 概述

logindata包负责登录相关的数据操作。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.3.1.2 整体架构

此包为数据层的一部分，负责登录的数据操作。它实现了logindataservice的所有接口。

#### 2.3.1.3 设计

##### 2.3.1.3.1 设计图

![logindata](/img/设计图/logindata.png)

##### 2.3.1.3.2 各个类的职责

| 类名                  | 职责           |
| ------------------- | ------------ |
| LoginDataController | 负责登录相关的数据操作。 |

##### 2.3.1.3.3 内部类的接口规范

提供的接口

| 接口名称                                    | 语法                                       | 前置条件 | 后置条件          |
| --------------------------------------- | ---------------------------------------- | ---- | ------------- |
| logindataservice.LoginDataService.login | `public ResultMessage login(String username, String password);` | 无。   | 系统已经登录或者登录失败。 |


### 2.3.6 financedata包

#### 2.3.6.1 概述

financedata包负责财务人员除了银行账户管理外的用例（制定收款单、制定付款单、制定现金费用单、查看经营情况表、查看经营历程表、查看销售情况表、红冲以及期初建账）的数据操作。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.3.6.2 整体架构

此包为数据层的一部分，负责财务人员除了银行账户管理外的用例（制定收款单、制定付款单、制定现金费用单、查看经营情况表、查看经营历程表、查看销售情况表、红冲以及期初建账）的数据操作。它实现了financedataservice的所有接口。

#### 2.3.6.3 设计

##### 2.3.6.3.1 设计图

![financedata](/img/设计图/financedata.png)

##### 2.3.6.3.2 各个类的职责

| 类名                                 | 职责             |
| ---------------------------------- | -------------- |
| PaymentBillDataController          | 负责付款单的数据管理。    |
| ReceivalBillDataController         | 负责收款单的数据管理。    |
| CashBillDataController             | 负责现金费用单的数据管理。  |
| InitialEstablishmentDataController | 负责期初账的数据管理。    |
| TradeHistoryDataController         | 负责查询财务单据的数据管理。 |

##### 2.3.6.3.3 各个类的内部接口

**PaymentBillDataController**

提供的接口

| 接口名称                            | 语法                                       | 前置条件             | 后置条件                                  |
| ------------------------------- | ---------------------------------------- | ---------------- | ------------------------------------- |
| PaymentBillDataService.submit   | `public ResultMessage submit(PaymentBillPo bill);` | 用户已经登录，单据所有属性有效。 | 提交新单据。                                |
| PaymentBillDataService.activate | `public ResultMessage activate(PaymentBillPo bill);` | 单据有效且状态为审批通过。    | 系统修改对应银行账户和客户信息，修改单据状态为已入账，持久化信息已经保存。 |
| PaymentBillDataService.abandon  | `public ResultMessage abandon(PaymentBillPo bill);` | 单据有效且状态为审批完成。    | 系统修改单据状态为已经废弃，持久化信息已经保存。              |

**ReceivalBillDataController**

提供的接口

| 接口名称                         | 语法                                       | 前置条件             | 后置条件                                  |
| ---------------------------- | ---------------------------------------- | ---------------- | ------------------------------------- |
| CashBillDataService.submit   | `public ResultMessage submit(CashBillPo bill);` | 用户已经登录，单据所有属性有效。 | 提交新单据。                                |
| CashBillDataService.activate | `public ResultMessage activate(CashBillPo bill);` | 单据有效且状态为审批通过。    | 系统修改对应银行账户和客户信息，修改单据状态为已入账，持久化信息已经保存。 |
| CashBillDataService.abandon  | `public ResultMessage abandon(CashBillPo bill);` | 单据有效且状态为审批完成。    | 系统修改单据状态为已经废弃，持久化信息已经保存。              |

**CashBillDataController**

提供的接口

| 接口名称                         | 语法                                       | 前置条件             | 后置条件                                  |
| ---------------------------- | ---------------------------------------- | ---------------- | ------------------------------------- |
| CashBillDataService.submit   | `public ResultMessage submit(CashBillPo bill);` | 用户已经登录，单据所有属性有效。 | 提交新单据。                                |
| CashBillDataService.activate | `public ResultMessage activate(CashBillPo bill);` | 单据有效且状态为审批通过。    | 系统修改对应银行账户和客户信息，修改单据状态为已入账，持久化信息已经保存。 |
| CashBillDataService.abandon  | `public ResultMessage abandon(CashBillPo bill);` | 单据有效且状态为审批完成。    | 系统修改单据状态为已经废弃，持久化信息已经保存。              |

**InitialEstablishmentDataController**

提供的接口

| 接口名称                                     | 语法                                       | 前置条件         | 后置条件                 |
| ---------------------------------------- | ---------------------------------------- | ------------ | -------------------- |
| InitialEstablishmentDataService.submit   | `public ResultMessage submit(SystemSnapshotPo snapshot);` | 账有效且状态为审批通过。 | 账单独被保存，持久化数据已保存。     |
| InitialEstablishmentDataService.activate | `public ResultMessage activate(SystemSnapshotPo snapshot) ` | 账有效且状态为审批完成。 | 账状态被修改为已废弃，持久化数据已保存。 |
| InitialEstablishmentDataService.abandon  | `public ResultMessage abandon(SystemSnapshotPo snapshot);` | 账有效且状态为草稿。   | 系统记录需要继续填写账。         |

**TradeHistoryDataController**

提供的接口

| 接口名称                          | 语法                                       | 前置条件  | 后置条件                           |
| ----------------------------- | ---------------------------------------- | ----- | ------------------------------ |
| TradeHistoryDataService.query | `public BillPo[] query(FinanceBillQueryVo query);` | 输入有效。 | 返回符合条件的商品销售记录，若某一属性为null则为无限制。 |

### 2.3.7 bankaccountbl包

#### 2.3.7.1 概述

financedata包负责银行账户管理的数据操作。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.3.7.2 整体架构

此包为数据层的一个部分，负责银行账户管理的数据操作。它实现了dataservice层的所有接口。

#### 2.3.7.3 设计

##### 2.3.7.3.1 设计图

![bankaccountdata](/img/设计图/bankaccountdata.png)

##### 2.3.7.3.2 各个类的职责

| 类名                        | 职责              |
| ------------------------- | --------------- |
| BankAccountDataController | 负责实管理银行账户的数据操作。 |

##### 2.3.7.3.3 内部类的接口规范

**BankAccountDataController**

提供的接口

| 接口名称                                    | 语法                                       | 前置条件         | 后置条件                             |
| --------------------------------------- | ---------------------------------------- | ------------ | -------------------------------- |
| BankAccountManagementDataService.query  | `public BankAccountPo[] query(BankAccountQueryVo query);` | 查询条件合法。      | 返回满足条件的银行账户Po。某一项为null的意思是此项无限制。 |
| BankAccountManagementDataService.add    | `public ResultMessage add(BankAccountPo account);` | 新账户信息合法且无冲突。 | 新银行账户信息已经添加，持久化信息已经保存。           |
| BankAccountManagementDataService.modify | `public ResultMessage modify(BankAccountPo account); ` | 新账户信息合法且无冲突。 | 银行账户信息已经修改，持久化信息已经保存。            |
| BankAccountManagementDataService.delete | `public ResultMessage delete(BankAccountPo account);` | 新账户信息合法且无冲突。 | 选定账户信息已经删除，持久化信息已经保存。            |

### 2.3.8 draftdata包

#### 2.3.8.1 概述

draftdata包负责草稿相关的数据操作。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.3.8.2 整体架构

此包为数据层的一部分，负责草稿相关的数据操作。它实现了draftdataservice的所有接口。

#### 2.3.8.3 设计

##### 2.3.8.3.1 设计图

![draftdata](/img/设计图/draftdata.png)

##### 2.3.8.3.2 各个类的职责

| 类名                  | 职责           |
| ------------------- | ------------ |
| DraftDataController | 负责草稿相关的数据操作。 |

##### 2.3.8.3.3 内部类的接口规范

提供的接口
| 接口名称                                     | 语法                                       | 前置条件           | 后置条件             |
| ---------------------------------------- | ---------------------------------------- | -------------- | ---------------- |
| draftdataservice.DraftDataService.update | `public BillVo[] update(DraftQueryVo query);` | 无。             | 获得当前用户已经保存的草稿。   |
| draftdataservice.DraftDataService.delete | `public ResultMessage delete(BillVo bill);` | 选择的单据有效并状态是草稿。 | 将草稿删除，持久化信息已经保存。 |

### 2.3.9 logdata包

#### 2.3.9.1 概述

logdata包负责日志相关的数据操作。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.3.9.2 整体架构

此包为数据层的一部分，负责日志相关的数据操作。它实现了logdataservice的所有接口。

#### 2.3.9.3 设计

##### 2.3.9.3.1 设计图

![logdata](/img/设计图/logdata.png)

##### 2.3.9.3.2 各个类的职责

| 类名                | 职责           |
| ----------------- | ------------ |
| LogDataController | 负责日志相关的数据操作。 |

##### 2.3.9.3.3 内部类的接口规范

提供的接口

| 接口名称                                | 语法                                       | 前置条件       | 后置条件            |
| ----------------------------------- | ---------------------------------------- | ---------- | --------------- |
| logdataservice.LogDataService.query | `public LogPo[] query(LogQueryVo query);` | 无。         | 返回符合条件的日志。      |
| logdataservice.LogDataService.log   | `public ResultMessage log(LogSeverity severity, String content);` | content非空。 | 日志保存，持久化信息已经保存。 |

### 2.3.10 notificationdata包

#### 2.3.10.1 概述

notificationdata包负责通知相关的数据操作。具体功能需求和非功能需求可参见需求规格说明文档和体系结构设计文档。

#### 2.3.10.2 整体架构

此包为数据层的一部分，负责通知相关的数据操作。它实现了notificationdataservice的所有接口。

#### 2.3.10.3 设计

##### 2.3.10.3.1 设计图

![notificationdata](/img/设计图/notificationdata.png)

##### 2.3.10.3.2 各个类的职责

| 类名                        | 职责           |
| ------------------------- | ------------ |
| NotificatioDataController | 负责日志相关的数据操作。 |

##### 2.3.10.3.3 内部类的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件                   | 后置条件               |
| ---------------------------------------- | ---------------------------------------- | ---------------------- | ------------------ |
| notificationdataservice.NotificationDataService.add | `public ResultMessage addNotification(NotificationVo notification);` | notification有效。        | 将新通知写入数据库。         |
| notificationdataservice.NotificationDataService.update | `public NotificationPo[] update(NotificationQueryVo query);` | 无。                     | 返回符合条件已有的通知。       |
| notificationdataservice.NotificationDataService.acknowledge | `public ResultMessage acknowledge(NotificationPo notification);` | 参数notification有效非null。 | 删除已有的通知，持久化信息已经保存。 |

# 3. 依赖视角

下图是客户端和服务器端各自的包之间的依赖关系。

客户端
![物理包图_客户端](/img/物理包图_客户端.png)

服务器端

![服务器端_客户端](/img/物理包图_服务器端.png)


