# 进销存系统 软件体系结构描述文档

By Trap x00

## 0. 更新日志

| 修改人员 | 日期          | 变更原因    | 版本号  |
| ---- | ----------- | ------- | ---- |
| 陈俊达  | 2017/10/10  | 模板      | V0.0 |
| 陈俊达  | 2017//10/15 | 第一次作业草稿 | V0.1 |
| 张凌哲  | 2017//10/19 | 第二次作业整合 | V0.9 |

## 1. 引言

### 1.1 编制目的

本报告详细完成对进销存系统的概要设计，达到指导详细设计和开发的目的，同时实现和测试人员及用户的沟通。

本报告面向开发人员、测试人员及最终用户编写，是了解系统的导航。

## 2. 产品概述

一民营企业专业从事灯具照明行业，是某灯具的南京地区总代理，主要在南京负责品牌的推广及项目的落地销售、分销的批发等工作，服务对象包括项目业主、施工单位、分销商、设计院、终端用户等。现公司规模扩大，企业业务量、办公场所、员工数量都发生增加，需要适应新的环境，从而提高效率和用户满意度。

##3. 逻辑视角

进销存系统中，我们选择了分层体系结构风格，将系统分为展示层、业务逻辑层和数据层三层能够很好地示意整个高层抽象。展示层包含GUI页面的实现，业务逻辑层包含业务逻辑处理的实现，数据层负责数据的持久化和访问。分层体系结构的逻辑视角和逻辑设计方案下图所示。

![逻辑视角](表达逻辑视图.png)

![逻辑设计方案](逻辑包图.png)

## 4. 组合视角

### 4.1 开发包图

进销存系统的最终开发包设计如下表所示。

| 开发（物理包）                 | 依赖的其他开发包                                 |
| ----------------------- | ---------------------------------------- |
| mainui                  | loginui, inventoryui, saleui, productui, clientui, financeui, bankaccountui, draftui, logui, notificationui, adminui, promotionui, approvalui |
| helpui                  |                                          |
| loginui                 | loginblservice, helpui, 界面类库包,vo         |
| loginblservice          | vo                                       |
| loginbl                 | loginblservice, blutil, logindataservice, po |
| logindataservice        | logindata, JavaRMI, po                   |
| logindata               | logindataservice, datautil,po            |
| inventoryui             | inventoryblservice, helpui, 界面类库包,vo     |
| inventoryblserivce      | vo                                       |
| inventorybl             | inventoryblservice, inventorydataservice, productbl,draftbl,logbl,blutil,po |
| inventorydataservice    | inventorydata, JavaRMI, po               |
| inventorydata           | inventorydataservice ,databaseutil, po   |
| productui               | productblservice, helpui, 界面类库包, vo      |
| productblservice        | vo                                       |
| productbl               | productblservice, productdataservice, draftbl, logbl, blutil, po |
| productdataservice      | productdata, JavaRMI, po                 |
| productdata             | productdataservice, databaseutil ,po     |
| saleui                  | saleblservice,  helpui, 界面类库包, vo        |
| saleblservice           | vo                                       |
| salebl                  | saleblservice, saledataservice, inventorybl, productble, clientble, draftbl, logbl, promotionbl, blutil, po |
| saledataservice         | saledata, JavaRMI, po                    |
| saledata                | saledataservice, databaseutil, po        |
| clientui                | clientblserivce, helpui, 界面类库包, vo       |
| clientblserivce         | vo                                       |
| clientbl                | clientblserivce, clientdataservice, draftbl, logbl, blutil, po |
| clientdataservice       | clientdata, JavaRMI, po                  |
| clientdata              | clientdataservice, databaseutil, po      |
| financeui               | financeblservice, helpui, 界面类库包, vo      |
| financeblservice        | vo                                       |
| financebl               | financeblservice, financedataservice, inventorybl, salebl, bankcountbl, draftbl, logbl, blutil, po |
| financedataservice      | financedata, JavaRMI, po                 |
| financedata             | financedataservice, databaseutil, po     |
| bankaccountui           | bankaccountblserivce, helpui, 界面类库包, vo  |
| bankaccountblserivce    | vo                                       |
| bankaccountbl           | bankaccountblserivce, bankaccountdataservice, blutil, po |
| bankaccountdataservice  | bankaccountdata, JavaRMI, po             |
| bankaccountdata         | bankaccountdataservice, databaseutil,po  |
| draftui                 | draftblserivce, helpui, 界面类库包, vo        |
| draftblserivce          | vo                                       |
| draftbl                 | draftblserivce, draftdataservice, blutil, po |
| draftdataservice        | draftdata,JavaRMI, po                    |
| draftdata               | draftdataservice, databaseutil, po       |
| logui                   | logblservice, helpui, 界面类库包, vo          |
| logblservice            | vo                                       |
| logbl                   | logblser, logdataservice, po             |
| logdataservice          | logdata, JavaRMI, po                     |
| logdata                 | logdataservice, databaseutil, po         |
| notificationui          | notificationblservice, 界面类库包, vo         |
| notificationblservice   | vo                                       |
| notificationbl          | notificationblservice, notificationdataservice, inventorybl, salebl, productbl, clientbl, financebl, logbl, blutil, po |
| notificationdataservice | notificationdata, JavaRMI, po            |
| notificationdata        | notificationdataservice, databaseutil, po |
| adminui                 | adminblserivce, helpui, 界面类库包, vo        |
| adminblserivce          | vo                                       |
| adminbl                 | adminblserivce, admindataservice, logbl, blutil, po |
| admindataservice        | admindata, JavaRMI, po                   |
| admindata               | admindataservice, databaseutil, po       |
| promotionui             | promotionblserivce, helpui, 界面类库包, vo    |
| promotionblserivce      | vo                                       |
| promotionbl             | promotionblserivce, promotiondataservice, inventorybl, logbl, blutil, po |
| promotiondataservice    | promotiondata, JavaRMI, po               |
| promotiondata           | promotiondataservice, databaseutil, po   |
| approvalui              | approvalblserivce, helpui, 界面类库包, vo     |
| approvalblserivce       | vo                                       |
| approvalbl              | approvalblserivce, approvaldataservice, logbl	,blutil,po |
| approvaldataservice     | approvaldata, JavaRMI, po                |
| approvaldata            | approvaldataservice, databaseutil, po    |
| vo                      |                                          |
| po                      |                                          |
| blutil                  |                                          |
| 界面类库包                   |                                          |
| JavaRMI                 |                                          |
| databaseutil            |                                          |

进销存系统开发包图如下。

客户端：

![客户端开发包图](物理包图_客户端.png)

服务器端：

![服务器端开发包图](物理包图_服务器端.png)



### 4.2 运行时进程

在进销存系统中，会有多个客户端进程和一个服务器端进程，其进程图如下图所示。结合部署图，客户端进程是在客户端机器上运行，服务器端进程是在服务器端机器上运行。

![进程图](进程图.png)

### 4.3 物理部署

进销存系统中客户端构件是放在客户端机器上，服务器端构件是放在服务器端机器上。在客户端节点上，还要部署RMIStub构件。由于Java RMI构建属于JDK的一部分。所以，在系统JDK环境已经设置好的情况下，不需要再独立部署。部署图如下图所示。

![部署图](部署图.png)

## 5. 接口视角

### 5.1 模块的职责

客户端模块和服务器模块分别如下图所示。

![客户端模块视图](客户端模块视图.png)

![服务器端模块视图](服务器端模块视图.png)

客户端各层和服务器端各层的职责分别如下表所示。

| 客户端层        | 职责                         |
| ----------- | -------------------------- |
| **启动模块**    | **负责初始化网络通信机制，启动用户界面**     |
| **用户界面层 **  | **基于窗口的进销存管理系统客户端用户界面**    |
| **业务逻辑层**   | **对于用户界面的输入进行响应并进行业务处理逻辑** |
| **客户端网络模块** | **利用java RM机制查找RMI服务**     |

| 服务器端层        | 职责                              |
| ------------ | ------------------------------- |
| **启动模块**     | **负责初始化网络通信机制，启动用户界面**          |
| **数据层**      | **负责数据的持久化及数据访问接口**             |
| **服务器端网络模块** | **利用Java RMI机制开启RMI服务，注册RMI服务** |



每一层只是使用下方直接接触的层。层与层之间仅仅是通过接口的调用来完成的。层之间调用的接口如下表所示。

| 接口   | 服务调用房  | 服务提供方    |
| ---- | ------ | -------- |
| bankaccountblservice  | 客户端展示层 | 客户端业务逻辑层 |
| financeblservice      | 客户端展示层 | 客户端业务逻辑层 |
| commodityblservice    | 客户端展示层 | 客户端业务逻辑层 |
| inventoryblservice    | 客户端展示层 | 客户端业务逻辑层 |
| userblservice         | 客户端展示层 | 客户端业务逻辑层 |
| approvalblservice     | 客户端展示层 | 客户端业务逻辑层 |
| promotionblservice    | 客户端展示层 | 客户端业务逻辑层 |
| logblservice          | 客户端展示层 | 客户端业务逻辑层 |
| clientblservice       | 客户端展示层 | 客户端业务逻辑层 |
| saleblservice         | 客户端展示层 | 客户端业务逻辑层 |
| loginblservice        | 客户端展示层 | 客户端业务逻辑层 |
| notificationblservice | 客户端展示层 | 客户端业务逻辑层 |
| draftblservice        | 客户端展示层 | 客户端业务逻辑层 |
| bankaccountblservice  | 客户端业务逻辑层 | 服务器端数据层 |
| financeblservice      | 客户端业务逻辑层 | 服务器端数据层 |
| commodityblservice    | 客户端业务逻辑层 | 服务器端数据层 |
| inventoryblservice    | 客户端业务逻辑层 | 服务器端数据层 |
| userblservice         | 客户端业务逻辑层 | 服务器端数据层 |
| approvalblservice     | 客户端业务逻辑层 | 服务器端数据层 |
| promotionblservice    | 客户端业务逻辑层 | 服务器端数据层 |
| logblservice          | 客户端业务逻辑层 | 服务器端数据层 |
| clientblservice       | 客户端业务逻辑层 | 服务器端数据层 |
| saleblservice         | 客户端业务逻辑层 | 服务器端数据层 |
| loginblservice        | 客户端业务逻辑层 | 服务器端数据层 |
| notificationblservice | 客户端业务逻辑层 | 服务器端数据层 |
| draftblservice        | 客户端业务逻辑层 | 服务器端数据层 |

借用销售用例来说明层之间的调用，如图9所示。每一层之间都是由上一层依赖了一个接口(需接口)，而下层实现这个接口(供接口)。saleblservice提供了Sales界面所需要的所有业务逻辑功能。saledataservice提供了对数据库的增、删、改、查等操作。这样的实现就大大降低了层与层之间的耦合。



### 5.2 用户界面层的分解

系统存在33个用户界面，它们分别为登录界面、财务人员主界面、总经理主界面、进货销售人员主界面、库存管理人员主界面、管理员主界面、制定收款单、制定付款单、期初建账、银行账户管理、制定现金费用单、红冲、查看销售明细表、查看经营情况表、查看经营历程表、审批单据、制定促销策略、查看操作日志、制定销售单、制定进货单、制定销售退货单、制定进货退货单、管理客户信息、库存监控、库存查看、商品管理、库存盘点、商品分类管理、用户账户管理，以及共有功能：草稿箱、通知列表和共有弹出框：提示框和确认框。其用户界面之间的跳转如下图所示：

![用户界面和跳转](用户界面和跳转.png)



#### 5.2.1 用户界面层模块的职责

| 模块             | 职责           |
| -------------- | ------------ |
| mainui         | 管理界面之间的加载和关闭 |
| helpui         | 系统公用的界面      |
| loginui        | 系统的用户登录界面    |
| inventoryui    | 管理仓库的界面      |
| saleui         | 管理销售的界面      |
| productui      | 管理商品的界面      |
| clientui       | 管理客户的界面      |
| financeui      | 管理财务信息的界面    |
| bankaccountui  | 管理账户信息的页面    |
| draftui        | 管理草稿的界面      |
| logui          | 管理日志的界面      |
| notificationui | 管理通知的界面      |
| adminui        | 管理员的界面       |
| promotionui    | 总经理管理策略的界面   |
| approvalui     | 总经理批准单据的界面   |

#### 5.2.2 用户界面模块的接口规范

| 名称     | 语法                              | 前置条件       | 后置条件 |
| ------ | ------------------------------- | ---------- | ---- |
| mainui | public void init(String[] args) | 用户点击进入别的页面 | 加载页面 |

#### 5.2.3 用户界面模块设计原理

用户界面使用JavaFX来实现。



### 5.3 业务逻辑层的分解

#### 5.3.1 业务逻辑层模块的职责

| 模块                    | 职责                    |
| --------------------- | --------------------- |
| bankaccountblservice  | 负责实现商品分类与商品分类管理所需要的服务 |
| financeblservice      | 负责实现财务管理所需要的服务        |
| commodityblservice    | 负责实现商品管理所需要的服务        |
| inventoryblservice    | 负责实现商品仓库管理所需要的服务      |
| userblservice         | 负责实现用户管理所需要的服务        |
| approvalblservice     | 负责实现总经理批准单据所需要的服务     |
| promotionblservice    | 负责实现总经理管理销售策略所需要的服务   |
| logblservice          | 负责实现管理日志所需要的服务        |
| clientblservice       | 负责实现客户管理所需要的服务        |
| saleblservice         | 负责实现销售管理所需要的服务        |
| loginblservice        | 负责实现用户登录所需要的服务        |
| notificationblservice | 负责实现管理通知所需要的服务        |
| draftblservice        | 负责实现管理草稿所需要的服务        |

#### 5.3.2 业务逻辑模块的接口规范

##### bankaccountblservice的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件                  | 后置条件                   |
| ---------------------------------------- | ---------------------------------------- | --------------------- | ---------------------- |
| bankaccountblservice.BankAccountManagement.add | `public ResultMessage add(BankAccountVO newAccount)` | 新账户信息合法且无冲突，用户具有最高权限。 | 新银行账户信息已经添加，持久化信息已经保存。 |
| bankaccountblservice.BankAccountManagement.modify | `public ResultMessage modify(BankAccountVO newAccount)` | 新账户信息合法且无冲突，用户具有最高权限。 | 银行账户信息已经修改，持久化信息已经保存。  |
| bankaccountblservice.BankAccountManagement.query | `public BankAccountVO[] query(BankAccountQueryVO query)` | 查询条件合法。               | 返回符合查询条件的数据。           |
| bankaccountblservice.BankAccountManagement.delete | `public ResultMessage delete(BankAccountVO account)` | 选择的账户合法，用户具有最高权限。     | 选定账户信息已经删除，持久化信息已经保存。  |

需要的接口

| 接口名称                                     | 服务名            |
| ---------------------------------------- | -------------- |
| `bankaccountdataservice.BankAccountManagement.query(String ID, String name)` | 根据ID和/或名称查询账户。 |
| `bankaccountdataservice.BankAccountManagement.add(BankAccountPO account)` | 添加账户。          |
| `bankaccountdataservice.BankAccountManagement.modify(BankAccountPO account)` | 修改账户信息。        |
| `bankaccountdataservice.BankAccountManagement.delete(BankAccountPO account)` | 删除账户信息。        |
| `logbl.Logger.Log(LogSeverity severity, Sring content)` | 记录日志。          |

##### financeblservice的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件                         | 后置条件                                  |
| ---------------------------------------- | ---------------------------------------- | ---------------------------- | ------------------------------------- |
| financeblservice.ReceivalBill.submit     | `public ResultMessage submit(ReceivalBillVO bill)` | 单据所有属性有效。                    | 单据已经保存到数据库，持久化信息已经保存。                 |
| financeblservice.ReceivalBill.saveAsDraft | `public ResultMessage saveAsDraft(ReceivalBillVO bill)` | 单据信息非空。                      | 保存草稿，持久化信息已经保存。                       |
| financeblservice.ReceivalBill.resume     | `public ReceivalBillVO resume()`         | 开始填写。                        | 如果系统记录需要继续填写单据，那么返回值为继续填写的单据；反之为null。 |
| financebl.ReceivalBill.activate          | `public ResultMessage activate(ReceivalBillPO bill)` | 单据有效且状态为审批通过。                | 系统修改对应银行账户和客户信息，修改单据状态为已入账，持久化信息已经保存。 |
| financebl.ReceivalBill.abandon           | `public ResultMessage abandon(ReceivalBillPO bill)` | 单据有效且状态为审批完成。                | 系统修改单据状态为已经废弃，持久化信息已经保存。              |
| financebl.ReceivalBill.resume            | `public ResultMessage resume(ReceivalBillVO draft)` | 草稿有效。                        | 系统记录需要继续填写单据。                         |
| financeblservice.PaymentBill.submit      | `public ResultMessage submit(PaymentBillVO bill)` | 单据所有属性有效。                    | 单据已经保存到数据库，持久化信息已经保存。                 |
| financeblservice.PaymentBill.saveAsDraft | `public ResultMessage saveAsDraft(PaymentBillVO bill)` | 单据信息非空。                      | 保存草稿，持久化信息已经保存。                       |
| financeblservice.PaymentBill.resume      | `public PaymentBillVO resume()`          | 开始填写。                        | 如果系统记录需要继续填写单据，那么返回值为继续填写的单据；反之为null。 |
| financebl.PaymentBill.activate           | `public ResultMessage activate(PaymentBillPO bill)` | 单据有效且状态为审批通过。                | 系统修改对应银行账户和客户信息，修改单据状态为已入账，持久化信息已经保存。 |
| financebl.PaymentBill.abandon            | `public ResultMessage abandon(PaymentBillPO bill)` | 单据有效且状态为审批完成。                | 系统修改单据状态为已经废弃，持久化信息已经保存。              |
| financebl.PaymentBill.resume             | `public ResultMessage resume(PaymentBillVO draft)` | 草稿有效。                        | 系统记录需要继续填写单据。                         |
| financeblservice.CashBill.submit         | `public ResultMessage submit(CashBillVO bill)` | 单据所有属性有效。                    | 单据已经保存到数据库，持久化信息已经保存。                 |
| financeblservice.CashBill.saveAsDraft    | `public ResultMessage saveAsDraft(CashBillVO bill)` | 单据信息非空。                      | 保存草稿，持久化信息已经保存。                       |
| financeblservice.CashBill.resume         | `public CashBillVO resume()`             | 开始填写。                        | 如果系统记录需要继续填写单据，那么返回值为继续填写的单据；反之为null。 |
| financebl.CashBill.activate              | `public ResultMessage activate(CashBillPO bill)` | 单据有效且状态为审批通过。                | 系统修改对应银行账户，修改单据状态为已入账，持久化信息已经保存。      |
| financebl.CashBill.abandon               | `public ResultMessage abandon(CashBillPO bill)` | 单据有效且状态为审批完成。                | 系统修改单据状态为已经废弃，持久化信息已经保存。              |
| financebl.CashBill.resume                | `public ResultMessage resume(CashBillVO draft)` | 草稿有效。                        | 系统记录需要继续填写单据。                         |
| financeblservice.SaleDetail.query        | `public SaleDetailVO query(SaleDetailQueryVO query)` | 输入的query不为空。其中值为null的字段为不限制。 | 返回销售明细表。                              |
| financeblservice.SaleDetail.export       | `public ResultMessage export(SaleDetailVO detail)` | 表不为空且有效。                     | 导出单据。                                 |
| financeblservice.TradeHistory.query      | `public TradeHistoryVO query(TradeHistoryQueryVO query)` | 输入的query不为空。其中值为null字段的为不限制。 | 返回符合条件的单据。                            |
| financeblservice.TradeHistory.revert     | `public RevertBillController revert(BillVO selectedBill) ` | selectedBill不为空且有效。          | 返回RevertBillController对象，进入红冲处理。      |
| financeblservice.TradeHistory.export     | `public ResultMessage export(TradeHistoryVO bills)` | bills参数不为空且有效。               | 导出报表。                                 |
| financeblservice.TradeHistory.query      | `public TradeHistoryVO query(TradeHistoryQueryVO query)` | 输入的query不为空。其中值为null字段的为不限制。 | 返回符合条件的单据。                            |
| financeblservice.TradeHistory.revert     | `public RevertBillController revert(BillVO selectedBill) ` | selectedBill不为空且有效。          | 返回RevertBillController对象，进入红冲处理。      |
| financeblservice.TradeHistory.export     | `public ResultMessage export(TradeHistoryVO bills)` | bills参数不为空且有效。               | 导出报表。                                 |
| financeblservice.RevertBill.init         | `public void init(BillVO bill)`          | 通过选取单据，初始化红冲处理。              | 初始化红冲单据内容。                            |
| financeblservice.RevertBill.submit       | `public ResultMessage submit(BillVO newBill)` | 新单据不为空且数据有效。                 | 单据提交，持久化数据已保存。                        |
| financeblservice.RevertBill.saveAsDraft  | `public ResultMessage saveAsDraft(BillVO bill)` | 单据非空。                        | 保存草稿，持久化数据已保存。                        |
| financeblservice.TradeSituation.query    | `public TradeSituationVO query(Date[] timePeriod)` | 输入时间段有效。                     | 返回时间段内的经营情况。                          |
| financeblservice.TradeSituation.export   | `public ResultMessage export(TradeSituationVO situation)` | 选定表格非空。                      | 导出报表。                                 |
| financeblservice.InitialEstablishment.autofill | `public SystemSnapshotVO autofill()`     | 无。                           | 返回现有系统信息。                             |
| financeblservice.InitialEstablishment.submit | `public ResultMessage submit(SystemSnapshotVO snapshot)` | 账所有属性有效。                     | 将账计入数据库，持久化数据已保存。                     |
| financeblservice.InitialEstablishment.saveAsDraft | `public ResultMessage saveAsDraft(SystemSnapshotVO snapshot)` | 表中内容非空。                      | 保存草稿，持久化数据已保存。                        |
| financeblservice.InitialEstablishment.resume | `public SystemSnapshotVO resume()`       | 开始填写。                        | 如果系统记录需要继续填写账，那么返回值为继续填写的账；反之为null。   |
| financebl.InitialEstablishment.activate  | `public ResultMessage activate(SystemSnapshotPO snapshot)` | 账有效且状态为审批通过。                 | 账单独被保存，持久化数据已保存。                      |
| financebl.InitialEstablishment.abandon   | `public ResultMessage abandon(SystemSnapshotPO snapshot)` | 账有效且状态为审批完成。                 | 账状态被修改为已废弃，持久化数据已保存。                  |
| financebl.InitialEstablishment.resume    | `public ResultMessage resume(SystemSnapshotVO snapshot)` | 账有效且状态为草稿。                   | 系统记录需要继续填写账。                          |

需要的接口

| 接口名称                                     | 服务名          |
| ---------------------------------------- | ------------ |
| `financedataservice.ReceivalBill.submit(ReceivalBillPO bill)` | 提交新单据。       |
| `financedataservice.ReceivalBill.activate(ReceivalBillPO bill) ` | 使单据入账。       |
| `financedataservice.ReceivalBill.abandon(ReceivalBillPO bill)` | 废弃单据。        |
| `financedataservice.PaymentBill.submit(PaymentBillPO bill)` | 提交新单据。       |
| `financedataservice.PaymentBill.activate(PaymentBillPO bill) ` | 使单据入账。       |
| `financedataservice.PaymentBill.abandon(PaymentBillPO bill)` | 废弃单据。        |
| `financedataservice.CashBill.submit(CashBillPO bill)` | 提交新单据。       |
| `financedataservice.CashBill.activate(CashBillPO bill)` | 使单据入账。       |
| `financedataservice.CashBill.abandon(CashBillPO bill)` | 废弃单据。        |
| `financedataservice.SaleDetail.query(Date[] timeRange, String commodityName, ClientPO client, SaleStaffPO operator, InventoryPO inventory)` | 根据条件查找单据。    |
| `financedataservice.TradeHistory.query(Date[] timeRange, BillType billType, ClientPO client, EmployeePO operator, InventoryPO inventory)` | 根据条件查找单据。    |
| `financedataservice.TradeSituation.query(Date[] timePeriod)` | 查询时间段内的经营情况。 |
| `financedataservice.InitialEstablishment.submit(SystemSnapshotPO snapshot)` | 提交新单据。       |
| `financedataservice.InitialEstablishment.activate(SystemSnapshotPO snapshot)` | 系统记入账。       |
| `financedataservice.InitialEstablishment.abandon(SystemSnapshotPO snapshot)` | 废弃单据。        |
| `draftbl.DraftManagement.saveAsDraft(ReceivalBillVO bill)` | 保存草稿。        |
| `draftbl.DraftManagement.saveAsDraft(PaymentBillVO bill)` | 保存草稿。        |
| `draftbl.DraftManagement.saveAsDraft(SystemSnapshotVO snapshot)` | 保存草稿。        |
| `draftbl.DraftManagement.saveAsDraft(CashBillVO bill)` | 保存草稿。        |
| `draftbl.DraftManagement.saveAsDraft(RevertBillVO bill)` | 保存草稿。        |
| `logbl.Logger.Log(LogSeverity severity, Sring content)` | 记录日志。        |

#####commodityblservice的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件                 | 后置条件                  |
| ---------------------------------------- | ---------------------------------------- | -------------------- | --------------------- |
| commodityblservice. GoodsManagement.add  | `public ResultMessage add(CommodityVO newCommodity)` | 商品输入合法。              | 添加新的商品，持久化更新涉及的对象的数据。 |
| commodityblservice.GoodsManagement.modify | `public ResultMessage modify(CommodityVO updateCommodity)` | 商品信息修改输入合法。          | 修改商品，持久化更新涉及的对象的数据。   |
| commodityblservice.GoodsManagement.query | `public CommodityVO[] query(String ID, String name)` | 查询输入格式合法。            | 返回符合查询条件的数据。          |
| commodityblservice.GoodsManagement.delete | `public ResultMessage delete(CommodityVO commodity)` | 商品信息输入合法。            | 删除该商品，持久化更新涉及的对象的数据。  |
| commodityblservice. ProductManagement.add | `public ResultMessage add(CommoditySortVO newCSort,CommoditySortVO parentSort)` | 商品分类信息输入合法，并且父类中无商品。 | 添加新的商品分类，持久化更对象的数据。   |
| commodityblservice.ProductManagement.modify | `public ResultMessage modify(CommoditySortVO CSort)` | 商品分类修改信息输入合法。        | 更改商品分类，持久化更新涉及的对象的数据。 |
| commodityblservice.ProductManagement.query | `public CommoditySortVO[] query(String ID, String name)` | 商品分类查询信息输入合法。        | 返回符合查询条件的数据。          |
| commodityblservice.ProductManagement.delete | `public ResultMessage delete(CommoditySortVO CSort)` | 商品分类删除信息输入合法。        | 删除商品分类，持久化更新涉及的对象的数据。 |
| commodityblservice.ProductManagement.display | ` public CommoditySortVO[] display()`    | 已经创建一个CommoditySort。 | 显示所有商品分类。             |
| commodityblservice.ProductManagement.display | `public CommoditySortVO[] dispaly(CommoditySortVO commoditySort)` | 该父类存在。               | 显示父类下的所有子类。           |


需要的接口

| 接口名称                                     | 服务名                 |
| ---------------------------------------- | ------------------- |
| `commoditydataservice.GoodsManagement.query(String ID, String name)` | 根据ID和/或名称查找单一持久化对象。 |
| `commoditydataservice.GoodsManagement.add(CommodityPO commodity)` | 添加单一化持久对象。          |
| `commoditydataservice.GoodsManagement.modify(CommodityPO updateCommodity)` | 修改添加单一化持久对象。        |
| `commoditydataservice.GoodsManagement.delete(CommodityPO commodity)` | 删除单一化持久对象。          |
| `commoditydataservice.ProductManagement.query(String ID, String name)` | 根据ID和/或名称模糊化查询。     |
| `commoditydataservice.ProductManagement.add(CommodityPO commodity)` | 添加单一持久化对象。          |
| `commoditydataservice.ProductManagement.modify(CommodityPO updateCommodity)` | 修改单一持久化对象。          |
| `commoditydataservice.ProductManagement.delete(CommodityPO commodity)` | 删除单一持久化对象爱那个。       |
| ` logbl.Logger.Log(LogSeverity severity, Sring content)` | 记录日志。               |

##### Inventoryblservice的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件              | 后置条件                                     |
| ---------------------------------------- | ---------------------------------------- | ----------------- | ---------------------------------------- |
| Inventoryblservice.InventoryCheck.check  | `public InventoryViewVO check(Date beginTime, Date endTime)` | 日期输入合法。           | 完成在此时间段内的出／入库数量／金额，销售／进货数量／金额，以及库存合计的查看。 |
| Inventoryblservice.InventoryCheck.picture | `public InventoryPictureVO picture()`    | 已经得到当日库存快照。       | 生成截至盘点时间的库存盘点。                           |
| Inventoryblservice.InventoryCheck.export | `public ResultMessage export(File newfile)` | 已经完成库存盘点。         | 导出Excel到指定位置。                            |
| Inventoryblservice.InventoryGift.sumbit  | `public InventoryGiftVO check(InventoryGiftVO inventoryGiftVO)` | 输入合法。             | 完成商品赠送提交赠送单，持久化更新涉及的对象的数据。               |
| Inventoryblservice.InventoryWarning.submit | `public ResultMessage submit(InventoryBillVO bill)` | 单据所有属性有效。         | 单据已经保存到数据库，持久化信息已经保存。                    |
| Inventoryblservice.InventoryWarning.saveAsDraft | `public ResultMessage saveAsDraft(InventoryBillVO bill)` | 单据信息非空。           | 保存草稿，持久化信息已经保存。                          |
| Inventoryblservice.InventoryWarning.resume | `public InventoryBillVO resume()`        | 开始填写。             | 如果系统记录需要继续填写单据，那么返回值为继续填写的单据；反之为null。    |
| Inventoryblservice.InventoryWarning.modify | `public ResultMessage modify(CommodityVO commodity，double modifyWarning)` | 该商品存在，且修改警戒值输入合法。 | 修改警戒值，持久化更新涉及的对象的数据。                     |
| Inventoryblservice.InventoryWarning.getCurrentBill | `public InventoryBillVO getCurrentBill()` | 现有单据存在。           | 返回现有单据。                                  |
| inventoryblservice.PurchaseBill.submit   | `public ResultMessage submit(PurchaseBillVO purchaseBill)` | 表单数据输入格式正确。       | 持久化层新增表单信息。                              |
| inventoryblservice.PurchaseBill.saveAsDraft | `public ResultMessage saveAsDraft(PurchaseRefundBillVO purchaseRefundBill)` | 表单数据非空。           | 持久化层保存草稿信息。                              |
| inventoryblservice.PurchaseRefundBill.submit | `public ResultMessage submit(PurchaseRefundBillVO purchaseRefundBill)` | 表单数据输入格式正确。       | 持久化层新增表单信息。                              |
| inventoryblservice.PurchaseRefundBill.saveAsDraft | `public ResultMessage saveAsDraft(PurchaseRefundBillVO purchaseRefundBill)` | 表单数据非空。           | 持久化层保存草稿信息。                              |

需要的接口

| 接口名称                                     | 服务名           |
| ---------------------------------------- | ------------- |
| `Inventorydataservice.InventoryCheck.check(Date beginTime, Date endTime)` | 提供时间段内库存变化。   |
| `Inventorydataservice.InventoryCheck.picture(Date time)` | 提供当日库存快照。     |
| `Inventorydataservice.InventoryGift.getGift(Date time)` | 提供满足促销条件的赠送单。 |
| `Inventorydatablservice.InventoryWarning.submit(InventoryBillPO bill)` | 提交新单据。        |
| `Inventorydatablservice.InventoryWarning.modify(CommodityPO commodity，double ModifyWarning)` | 修改警戒值。        |
| `inventorydataservice.PurchaseBill.submit(PurchaseBillPO purchaseBill)` | 提交表单。         |
| `inventorydataservice.PurchaseRefundBill.submit(PurchaseRefundBillPO purchaseRefundBill)` | 提交表单。         |
| `draftbl.saveAsDraft(PurchaseBillPO purchaseBill)` | 保存草稿。         |
| `draftbl.saveAsDraft(InventoryBillVO bill)` | 保存草稿。         |
| `logbl.Logger.Log(LogSeverity severity, Sring content)` | 记录日志。         |

##### userblservice的接口定义

提供的接口

| 接口名称                                | 语法                                       | 前置条件                  | 后置条件                  |
| ----------------------------------- | ---------------------------------------- | --------------------- | --------------------- |
| userblservice.UserManagement.add    | `public ResultMessage add(UserAccoutVO newAccount)` | 新账户信息合法且无冲突，用户具有最高权限。 | 新账户信息已经添加，持久化信息已经保存。  |
| userblservice.UserManagement.modify | `public ResultMessage modify(UserAccoutVO newAccount)` | 新账户信息合法且无冲突，用户具有最高权限。 | 账户信息已经修改，持久化信息已经保存。   |
| userblservice.UserManagement.query  | `public UserAccoutVO[] query(UserAccoutQueryVO query)` | 查询条件合法。               | 返回符合查询条件的数据。          |
| userblservice.UserManagement.delete | `public ResultMessage delete(UserAccoutVO account)` | 选择的账户合法，用户具有最高权限。     | 选定账户信息已经删除，持久化信息已经保存。 |

需要的接口

| 接口名称                                     | 服务名            |
| ---------------------------------------- | -------------- |
| `userdataservice.UserManagement.query(String ID, String name,Stirng accountName, String password,boolean hasRoot)` | 根据ID和/或名称查询账户。 |
| `userdataservice.UserManagement.add(UserAccoutPO account)` | 添加账户。          |
| `userdataservice.UserManagement.modify(UserAccoutPO account)` | 修改账户信息。        |
| `userdataservice.UserManagement.delete(UserAccoutPO account)` | 删除账户信息。        |
| `logbl.Logger.Log(LogSeverity severity, Sring content)` | 记录日志           |

##### approvalblservice的接口规范

提供的接口

| 接口名称                           | 语法                                       | 前置条件          | 后置条件                  |
| ------------------------------ | ---------------------------------------- | ------------- | --------------------- |
| approvalblservice.Audit.query  | `public ResultMessage  show (BillQueryVO query)` | 有处于提交状态的单据单据。 | 返回符合条件的单据。            |
| Approvalblservice.Audit.reject | `public ResultMessage reject(BillVO bill)` | 用户已经查看了单据内容。  | 拒绝通过审批，持久化更新涉及的对象的数据。 |
| Approvalblservice.Audit.pass   | `public ResultMessage pass(BillVO bill)` | 用户已经查看了单据内容。  | 通过审批，持久化更新涉及的对象的数据。   |

需要的接口

| 接口名称                                     | 服务名          |
| ---------------------------------------- | ------------ |
| `promotiondataservice.Audit.query(String ID,BillType type, Date date,BillState state)` | 得到待审批的持久化对象。 |
| `promotiondataservice.Audit.reject(BillPO bill)` | 拒绝通过审批。      |
| `promotiondataservice.Audit.pass(BillPO bill)` | 通过审批。        |
| `logbl.Logger.Log(LogSeverity severity, Sring content)` | 记录日志。        |

##### promotionblservice的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件                                | 后置条件                                    |
| ---------------------------------------- | ---------------------------------------- | ----------------------------------- | --------------------------------------- |
| promotionblservice.PromotionManagement.submit | `public ResultMessage submit(PromotionVO newPromotion)` | 促销策略所有属性有效。                         | 持久化促销策略信息已经保存。                          |
| promotionblservice.PromotionManagement.saveAsDraft | `public ResultMessage saveAsDraft(PromotionVO promotion)` | 促销策略信息非空。                           | 保存草稿，持久化信息已经保存。                         |
| promotionservice.PromotionManagement.resume | `public PromotionVO resume()`            | 开始填写。                               | 如果系统记录需要继续填写促销策略，那么返回值为继续填写的单据；反之为null。 |
| promotionblservice.PromotionManagement.queryPromotion | `public PromotionVO[] queryPromotion(PromotionQueryVO query)` | 输入的query不为空，其中值为null字段的为不限制，筛选条件有效。 | 返回符合条件的商品。                              |
| promotionblservice.PromotionManagement.delete | `public ResultMessage delete(PromotionVO promotion)` | 选择删除促销策略。                           | 返回删除是否成功，持久化更新涉及的对象的数据。                 |
| promotionblservice.PromotionManagement.queryCommodity | `public CommodityVO[] queryCommodity(CommodityQueryVO query)` | 输入的query不为空，其中值为null字段的为不限制，筛选条件有效。 | 返回符合条件的商品。                              |

需要的接口

| 接口名称                                     | 服务名                         |
| ---------------------------------------- | --------------------------- |
| `promotiondataservice.PromotionManagement.submit(PromotionPO promotion,PromotionItem[] items)` | 提交新促销策略。                    |
| `promotiondataservice.PromotionManagement.queryPromotion(Date[] timeRange,PromotionType promotionType,Client client,double totalPrice)` | 根据不同的筛选条件查找促销策略。            |
| `promotiondataservice.Promotion.getPromotionItemsByIDs(String...ID)` | 通过ID集合拿到PromotionItems对象集合。 |
| `promotiondataservice.Promotion.delete(PromotionPO promotion)` | 删除单一持久化对象。                  |
| `promotiondataservice.PromotionManagement.queryCommodity(String ID,String type,String name)` | 根据商品标识查找商品。                 |
| `draftbl.DraftManagement.saveAsDraft(PromotionPO promotion)` | 保存草稿。                       |
| `logbl.Logger.Log(LogSeverity severity, Sring content)` | 记录日志。                       |

##### logblservice的接口规范

提供的接口

| 接口名称                      | 语法                                       | 前置条件           | 后置条件            |
| ------------------------- | ---------------------------------------- | -------------- | --------------- |
| logblservice.Logger.query | `public LogVO[] query(LogQueryVO query)` | 用户已经登录，具有最高权限。 | 返回操作日志。         |
| logblservice.Logger.log   | `public ResultMessage log(LogSeverity severity, String content)` | content非空。     | 日志保存，持久化信息已经保存。 |

需要的接口

| 接口名称                                     | 服务名           |
| ---------------------------------------- | ------------- |
| `logdataservice.Logger.query(Date date,LogSeverity severity,String content) ` | 得到持久化的操作日志对象。 |
| `logdataservice.Logger.log(LogSeverity severity, String content)` | 记录日志。         |

##### clientblservice的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件        | 后置条件         |
| ---------------------------------------- | ---------------------------------------- | ----------- | ------------ |
| clientblservice.ClientManagement.query   | `public ClientVO[] query(String query)`  | 查询条件合法。     | 返回符合条件的客户信息。 |
| clientblservice.ClientManagement.saveAsDraft | `public ResultMessage saveAsDraft(ClientVO client)` | 客户信息非空。     | 持久化层保存草稿信息。  |
| clientblservice.ClientManagement.modify  | `public ResultMessage modify(ClientVO client)` | 表单数据输入格式正确。 | 持久化层更新客户信息。  |
| clientblservice.ClientManagement.add     | `public ResultMessage add(ClientVO client)` | 表单数据输入格式正确。 | 持久化层更新客户信息。  |
| clientblservice.ClientManagement.delete  | `public ResultMessage delete(ClientVO[] client)` | 删除列表非空。     | 持久化层更新客户信息。  |
| clientblservice.ClientManagement.detail  | `public CilentVO detail(ClientVO[] client)` | 客户id非空。     | 持久化层返回客户信息。  |

需要的接口

| 接口名称                                     | 服务名           |
| ---------------------------------------- | ------------- |
| `clientdataservice.ClientManagement.query(String query)` | 根据查询条件查询客户信息。 |
| `draftbl.DraftManagement.saveAsDraft(ClientPO client)` | 保存客户草稿。       |
| `clientdataservice.ClientManagement.modify(ClientPO client) ` | 修改客户信息。       |
| `clientdataservice.ClientManagement.add(ClientPO client)` | 添加客户。         |
| `clientdataservice.ClientManagement.delete(ClientPO[] client)` | 删除客户信息。       |
| `clientdataservice.ClientManagement.detail(ClientPO client)` | 查询客户详细信息。     |
| `logbl.Logger.Log(LogSeverity severity, Sring content)` | 记录日志          |

##### saleblservice的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件        | 后置条件        |
| ---------------------------------------- | ---------------------------------------- | ----------- | ----------- |
| saleblservice.SaleBill.submit            | `public ResultMessage[] submit(SaleBillVO saleBill)` | 表单数据输入格式正确。 | 持久化层新增表单信息。 |
| saleblservice.SaleBill.saveAsDraft       | `public ResultMessage saveAsDraft(SaleBillVO saleBill)` | 用户已经点击保存草稿。 | 持久化层保存草稿信息。 |
| saleblservice.SaleRefundBill.submit      | `public ResultMessage[] submit(SaleRefundBillVO saleRefundBill)` | 表单数据输入格式正确。 | 持久化层新增表单信息。 |
| saleblservice.SaleRefundBill.saveAsDraft | `public ResultMessage saveAsDraft(SaleRefundBillVO saleRefundBill)` | 用户已经点击保存草稿。 | 持久化层保存草稿信息。 |

需要的接口

| 接口名称                                     | 服务名   |
| ---------------------------------------- | ----- |
| `saleblservice.SaleBill.submit(SaleBillPO saleBill)` | 提交表单。 |
| `draftbl.DraftManagement.saveAsDraft(SaleBillPO saleBill)` | 保存草稿。 |
| `saleblservice.SaleRefundBill.submit(SaleRefundBillPO saleRefundBill)` | 提交表单。 |
| `draftbl.DraftManagement.saveAsDraft(SaleRefundBillPO saleRefundBill)` | 保存草稿。 |
| `logbl.Logger.Log(LogSeverity severity, Sring content)` | 记录日志。 |

##### loginblservice的接口规范

提供的接口

| 接口名称                       | 语法                                       | 前置条件 | 后置条件          |
| -------------------------- | ---------------------------------------- | ---- | ------------- |
| loginblservice.Login.login | `public ResultMessage login(String username, String password)` | 无。   | 系统已经登录或者登录失败。 |

需要的接口

| 接口名称                                     | 服务名   |
| ---------------------------------------- | ----- |
| `logindataservice.Login.login(String username, String password)` | 登录。   |
| `logbl.Logger.Log(LogSeverity severity, Sring content)` | 记录日志。 |

##### notificationblservice的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件                      | 后置条件                                |
| ---------------------------------------- | ---------------------------------------- | ------------------------- | ----------------------------------- |
| notificationblservice.Notification.update | `public NotificationVO[] update()`       | 无。                        | 返回当前用户已有的通知。                        |
| notificationblservice.Notification.acknowledge | `public ResultMessage acknowledge(NotificationVO notification)` | 参数notification有效非null。    | 删除已有的通知，持久化信息已经保存。                  |
| notificationblservice.Notification.activate | `public ResultMessage activate(NotificationVO notification)` | notification为已经通过审批的单据通知。 | 调用单据对应的activate方法，修改系统数据，持久化信息已经保存。 |
| notificationblservice.Notification.abandon | `public ResultMessage abandon(NotificationVO notification)` | notification为已经审批结束的单据通知。 | 单据被标记为废弃，持久化信息已经保存。                 |
| notificationblservice.Notification.modify | `public ResultMessage modify(NotificationVO notification)` | notification为审批未通过的单据通知。  | 继续填写信息，系统记录准备修改单据。                  |

需要的接口

| 接口名称                                     | 服务名   |
| ---------------------------------------- | ----- |
| `notificationdataservice.Notification.update()` | 更新通知。 |
| `notificationdataservice.Notification.acknowledge(NotificationPO notification)` | 已读通知。 |
| `logbl.Logger.Log(LogSeverity severity, Sring content)` | 记录日志。 |

##### draftblservice的接口规范

提供的接口

| 接口名称                                  | 语法                                       | 前置条件           | 后置条件             |
| ------------------------------------- | ---------------------------------------- | -------------- | ---------------- |
| draftblservice.DraftManagement.update | `public BillVO[] update()`               | 无。             | 获得当前用户已经保存的草稿。   |
| draftblservice.DraftManagement.delete | `public ResultMessage delete(BillVO bill)` | 选择的单据有效并状态是草稿。 | 将草稿删除，持久化信息已经保存。 |
| draftblservice.DraftManagement.resume | `public ResultMessage resume(BillVO bill)` | 选择的单据有效并状态是草稿。 | 系统记录准备继续填写单据。    |

需要的接口

| 接口名称                                     | 服务名   |
| ---------------------------------------- | ----- |
| `draftdataservice.DraftManagement.update()` | 更新草稿。 |
| `draftdataservice.DraftManagement.delete(BillVO bill)` | 删除草稿。 |

### 5.4 数据层的分解

数据层主要给业务逻辑层提供数据访问服务，包括对于持久化数据的增、删、改、查。持久化数据保存到SQLite数据库。

#### 5.4.1 数据层模块的职责

| 模块                      | 职责            |
| ----------------------- | ------------- |
| bankaccountdataservice  | 提供账户的增删改查操作   |
| financedataservice      | 提供财务的增删改查操作   |
| commoditydataservice    | 提供商品的增删改查操作   |
| inventorydataservice    | 提供库存的增删改查操作   |
| userdataservice         | 提供用户信息的增删改查操作 |
| approvaldataservice     | 提供改变单据审批状态的操作 |
| promotiondataservice    | 提供促销策略的增删改查操作 |
| logdataservice          | 提供日志的增加和查看操作  |
| clientdataservice       | 提供客户信息的增删改查操作 |
| saledataservice         | 提供销售的增删改查操作   |
| logindataservice        | 提供登录信息的验证操作   |
| notificationdataservice | 提供通知的增删改查操作   |
| draftblservice          | 提供草稿的增删改查操作   |

#### 5.4.2 数据层模块的接口规范

##### bankaccountdataservice的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件         | 后置条件                             |
| ---------------------------------------- | ---------------------------------------- | ------------ | -------------------------------- |
| bankaccountdataservice.BankAccountManagement.query | `public BankAccountPO[] query(String ID, String name)` | 查询条件合法。      | 返回满足条件的银行账户PO。某一项为null的意思是此项无限制。 |
| bankaccountdataservice.BankAccountManagement.add | `public ResultMessage add(BankAccountPO account)` | 新账户信息合法且无冲突。 | 新银行账户信息已经添加，持久化信息已经保存。           |
| bankaccountdataservice.BankAccountManagement.modify | `public ResultMessage modify(BankAccountPO account) ` | 新账户信息合法且无冲突。 | 银行账户信息已经修改，持久化信息已经保存。            |
| bankaccountdataservice.BankAccountManagement.delete | `public ResultMessage delete(BankAccountPO account)` | 新账户信息合法且无冲突。 | 选定账户信息已经删除，持久化信息已经保存。            |


##### financedataservice的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件             | 后置条件                                  |
| ---------------------------------------- | ---------------------------------------- | ---------------- | ------------------------------------- |
| financedataservice.ReceivalBill.submit   | `public ResultMessage submit(ReceivalBillPO bill)` | 单据所有属性有效。        | 提交新单据。                                |
| financedataservice.ReceivalBill.activate | `public ResultMessage activate(ReceivalBillPO bill)` | 单据有效且状态为审批通过。    | 系统修改对应银行账户和客户信息，修改单据状态为已入账，持久化信息已经保存。 |
| financedataservice.ReceivalBill.abandon  | `public ResultMessage abandon(ReceivalBillPO bill)` | 单据有效且状态为审批完成。    | 系统修改单据状态为已经废弃，持久化信息已经保存。              |
| financedataservice.CashBill.submit       | `public ResultMessage submit(CashBillPO bill)` | 用户已经登录，单据所有属性有效。 | 提交新单据。                                |
| financedataservice.CashBill.activate     | `public ResultMessage activate(CashBillPO bill)` | 单据有效且状态为审批通过。    | 系统修改对应银行账户和客户信息，修改单据状态为已入账，持久化信息已经保存。 |
| financedataservice.CashBill.abandon      | `public ResultMessage abandon(CashBillPO bill)` | 单据有效且状态为审批完成。    | 系统修改单据状态为已经废弃，持久化信息已经保存。              |
| financedataservice.PaymentBill.submit    | `public ResultMessage submit(PaymentBillPO bill)` | 用户已经登录，单据所有属性有效。 | 提交新单据。                                |
| financedataservice.PaymentBill.activate  | `public ResultMessage activate(PaymentBillPO bill)` | 单据有效且状态为审批通过。    | 系统修改对应银行账户和客户信息，修改单据状态为已入账，持久化信息已经保存。 |
| financedataservice.PaymentBill.abandon   | `public ResultMessage abandon(PaymentBillPO bill)` | 单据有效且状态为审批完成。    | 系统修改单据状态为已经废弃，持久化信息已经保存。              |
| financedataservice.SaleDetail.query      | `public SaleDetailVO query(Date[] timeRange, String commodityName, ClientPO client, SaleStaffPO operator, InventoryPO inventory)` | 输入有效。            | 返回符合条件的商品销售记录，若某一属性为null则为无限制。        |
| financedataservice.TradeHistory.query    | `public TradeHistoryVO query(Date[] timeRange, BillType billType, ClientPO client, EmployeePO operator, InventoryPO inventory)` | 输入有效。            | 返回符合条件的商品销售记录，若某一属性为null则为无限制。        |
| financedataservice.RevertBill.submit     | `public ResultMessage submit(BillVO newBill)` | 单据有效。            | 保存单据信息，持久化信息已经保存。                     |
| financedataservice.TradeSituation.query  | `public TradeSituationVO query(Date[] timePeriod)` | 时间段有效。           | 返回时间段内的经营情况。                          |
| financedataservice.InitialEstablishment.submit | `public ResultMessage submit(SystemSnapshotPO snapshot)` | 账有效且状态为审批通过。     | 账单独被保存，持久化数据已保存。                      |
| financedataservice.InitialEstablishment.activate | `public ResultMessage activate(SystemSnapshotPO snapshot) ` | 账有效且状态为审批完成。     | 账状态被修改为已废弃，持久化数据已保存。                  |
| financedataservice.InitialEstablishment.abandon | `public ResultMessage abandon(SystemSnapshotPO snapshot)` | 账有效且状态为草稿。       | 系统记录需要继续填写账。                          |

##### commoditydataservice的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件          | 后置条件         |
| ---------------------------------------- | ---------------------------------------- | ------------- | ------------ |
| commoditydataservice. GoodsManagement.add | `public ResultMessage add(CommodityPO newCommodity)` | 同样的po在数据中不存在。 | 增加一条po数据。    |
| commoditydataservice.GoodsManagement.modify | `public ResultMessage modify(CommodityPO updateCommodity)` | 同样的po在数据中存。   | 更新po。        |
| commoditydataservice.GoodsManagement.query | `public CommodityPO[] query(String id, String name)` | 查询输入格式合法。     | 返回符合查询条件的数据。 |
| commoditydataservice.GoodsManagement.delete | `public ResultMessage delete(CommodityPO commodity)` | 同样的po在数据中存在。  | 删除po。        |
| commoditydataservice.GoodsManagement.init | `public void init()`                     | 无。            | 初始化持久数据。     |
| commoditydataservice. ProductManagement.add | `public ResultMessage add(CommoditySortPO newCSort,CommoditySortPO parentSort)` | 同样的po在数据中不存在。 | 增加一条po数据。    |
| commoditydataservice.ProductManagement.modify | `public ResultMessage modify(CommoditySortPO  CSort)` | 同样的po在数据中存在。  | 更新po。        |
| commoditydataservice.ProductManagement.query | `public CommoditySortPO[] query(String id, String name)` | 无 。           | 返回符合查询条件的数据。 |
| commoditydataservice.ProductManagement.delete | `public ResultMessage delete(CommoditySortPO  CSort)` | 同样的po在数据中存在   | 删除PO 。       |
| commoditydataservice.ProductManagement.display | ` public CommoditySortPO[] display()`    | 无。            | 返回所有商品分类。    |
| commoditydataservice.ProductManagement.display | `public CommoditySortPO[] dispaly(CommoditySortPO commoditySort)` | 同样的po在数据中存在。  | 返回父类下的所有子类。  |
| commoditydataservice.ProductManagement.initiation | `public void init()`                     | 无。            | 初始化持久数据。     |

##### Inventorydataservice的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件          | 后置条件                                     |
| ---------------------------------------- | ---------------------------------------- | ------------- | ---------------------------------------- |
| Inventorydataservice.InventoryCheck.check | `public InventoryViewPO submit(Date beginTime, Date endTime)` | 当天有库存进出且输入有效。 | 返回对应的InventoryViewPO。                    |
| Inventorydataservice.InventoryCheck.picture | `public InventoryPicturePO submit(Date time)` | 当天有库存快照。      | 返回对应的库存快照InventoryPicturePO。             |
| Inventorydataservice.InventoryCheck.init | `public void init()`                     | 无。            | 初始化持久数据。                                 |
| Inventorydataservice.InventoryGift.getGift | `public InventoryGiftPO getGift(Date time)` | 输入有效          | 若存在则返回符合条件的InventoryGiftPO，否则返回NULL。     |
| Inventorydataservice.InventoryGift.init  | `public void init()`                     | 无。            | 初始化持久数据。                                 |
| Inventorydataservice.InventoryWarning.submit | `public ResultMessage submit(InventoryBillPO bill)` | 单据属性有效。       | 提交新单据，返回提交是否成功。                          |
| Inventorydataservice.InventoryWarning.modify | `public ResultMessage modify(CommodityPO commodity，double ModifyWarning)` | 同样的po在数据中存在   | 更新po,修改警戒值。                              |
| Inventorydataservice.InventoryWarning.getAlarm | `public InventoryBillPO[] getAlarmByIDs(String... IDs)` | 输入有效。         | 返回InventoryBillPO对象集合，若ID为空或者null，返回空数组。 |
| Inventorydataservice.InventoryWarning.getOverflow | ` public InventoryBillPO[] getOverflowByIDs(String... IDs)` | 输入有效。         | 返回InventoryBillPO对象集合，若ID为空或者null，返回空数组。 |
| Inventorydataservice.InventoryWarning.getLoss | `public InventoryBillPO[] getLossByIDs(String... IDs)` | 输入有效。         | 返回InventoryBillPO对象集合，若ID为空或者null，返回空数组。 |
| Inventorydataservice.InventoryWarning.init | `public void init()`                     | 无。            | 初始化持久数据。                                 |
| inventorydataservice.PurchaseBill.submit | `public ResultMessage submit(PurchaseBillPO purchaseBill)` | 表单数据输入格式正确。   | 持久化层新增表单信息。                              |
| inventorydataservice.PurchaseRefundBill.submit | `public ResultMessage submit(PurchaseRefundBillPO purchaseRefundBill)` | 表单数据输入格式正确。   | 持久化层新增表单信息。                              |

##### userdataservice的接口定义

提供的接口

| 接口名称                                  | 语法                                       | 前置条件         | 后置条件                           |
| ------------------------------------- | ---------------------------------------- | ------------ | ------------------------------ |
| userdataservice.UserManagement.query  | `public UserAccoutPO[] query(String ID, String name,Stirng accountName, String password,boolean hasRoot)` | 查询条件合法。      | 返回满足条件的账户PO。某一项为null的意思是此项无限制。 |
| userdataservice.UserManagement.add    | `public ResultMessage add(UserAccoutPO account)` | 新账户信息合法且无冲突。 | 新账户信息已经添加，持久化信息已经保存。           |
| userdataservice.UserManagement.modify | `public ResultMessage modify(UserAccoutPO account) ` | 新账户信息合法且无冲突。 | 账户信息已经修改，持久化信息已经保存。            |
| userdataservice.UserManagement.delete | `public ResultMessage delete(UserAccoutPO account)` | 新账户信息合法且无冲突。 | 选定账户信息已经删除，持久化信息已经保存。          |

##### approvaldataservice的接口规范

提供的接口

| 接口名称                             | 语法                                       | 前置条件              | 后置条件            |
| -------------------------------- | ---------------------------------------- | ----------------- | --------------- |
| approvaldataservice.Audit.query  | `public BillVO[] query(String ID,BillType type, Date date,BillState state )` | po中存在处于提交状态的单据数据。 | 返回待审批单据。        |
| approvaldataservice.Audit.reject | `public ResultMessage reject(BillPO bill)` | 无。                | 修改并保存单据持久化对象数据。 |
| approvaldataservice.Audit.pass   | `public ResultMessage pass(BillPO bill)` | 无。                | 修改并保存单据持久化对象数据。 |

##### promotiondataservice的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件                     | 后置条件                                   |
| ---------------------------------------- | ---------------------------------------- | ------------------------ | -------------------------------------- |
| promotiondataserve.PromotionManagement.submit | `public ResultMessage submit(PromotionPO promotion,PromotionItem[] items)` | 促销策略所有属性有效，与已有促销策略不产生冲突。 | 保存组合商品降价促销策略持久化对象数据。                   |
| promotiondataservice.PromotionManagement.queryPromotion | `promotiondataservice.PromotionManagement.queryPromotion(Date[] timeRange,PromotionType promotionType,Client client,double totalPrice)` |                          |                                        |
| promotiondataservice.PromotionManagement.getPromotionItemByIDs | `public PromotionItem[] getPromotionItemByIDs(String…ID)` | 输入有效。                    | 返回PromotionItem对象集合，若ID为空或者null，返回空数组。 |
| promotiondataservice.PromotionManagement.delete | `public ResultMessage delete(PromotionPO promotion)` | 无。                       | 系统修改促销策略状态，更新并保存持久化信息。                 |
| promtiondataservice.PromotionManagement.queryCommodity | `public CommodityPO[] queryCommodity(String ID,String type,String name)` | 输入有效，其中值为null的字段表示无限制。   | 返回符合筛选条件的Commoidty对象数组。                |

##### logdataservice的接口规范

提供的接口

| 接口名称                      | 语法                                       | 前置条件       | 后置条件            |
| ------------------------- | ---------------------------------------- | ---------- | --------------- |
| logblservice.Logger.query | `public LogPO[] query(Date date,LogSeverity severity,String content)` | 无。         | 返回持久化的操作日志对象。   |
| logdataservice.Logger.log | `public ResultMessage log(LogSeverity severity, String content)` | content非空。 | 日志保存，持久化信息已经保存。 |

##### clientdataservice的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件        | 后置条件          |
| ---------------------------------------- | ---------------------------------------- | ----------- | ------------- |
| clientdataservice.ClientManagement.query | `public ClientPO[] query(String query)`  | 查询条件合法。     | 返回符合条件的用户信息。  |
| clientdataservice.ClientManagement.modify | `public ResultMessage saveAsDraft(ClientPO client)` | 表单数据输入格式正确。 | 持久化层更新客户信息。   |
| clientdataservice.ClientManagement.add   | `public ResultMessage add(ClientPO client)` | 表单数据输入格式正确。 | 持久化层更新客户信息。   |
| clientdataservice.ClientManagement.delete | `public ResultMessage delete(ClientPO[] client)` | 删除列表非空。     | 持久化层更新客户信息。   |
| clientdataservice.ClientManagement.detail | `public ClientPO detail(ClientPO[] client)` | 客户id非空。     | 持久化层返回客户详细信息。 |

##### saledataservice的接口规范

提供的接口

| 接口名称                                  | 语法                                       | 前置条件        | 后置条件        |
| ------------------------------------- | ---------------------------------------- | ----------- | ----------- |
| saledataservice.SaleBill.submit       | `public ResultMessage submit(SaleBillPO saleBill)` | 表单数据输入格式正确。 | 持久化层新增表单信息。 |
| saledataservice.SaleRefundBill.submit | `public ResultMessage submit(SaleRefundBillPO saleRefundBill)` | 表单数据输入格式正确。 | 持久化层新增表单信息。 |

##### logindataservice的接口规范

提供的接口

| 接口名称                         | 语法                                       | 前置条件 | 后置条件          |
| ---------------------------- | ---------------------------------------- | ---- | ------------- |
| logindataservice.Login.login | `public ResultMessage login(String username, String password)` | 无。   | 系统已经登录或者登录失败。 |

##### notificationdataservice的接口规范

提供的接口

| 接口名称                                     | 语法                                       | 前置条件                   | 后置条件               |
| ---------------------------------------- | ---------------------------------------- | ---------------------- | ------------------ |
| notificationdataservice.Notification.update | `public NotificationVO[] update()`       | 无。                     | 返回当前用户已有的通知。       |
| notificationdataservice.Notification.acknowledge | `public ResultMessage acknowledge(NotificationPO notification)` | 参数notification有效非null。 | 删除已有的通知，持久化信息已经保存。 |

##### draftdataservice的接口规范

提供的接口
| 接口名称                                    | 语法                                       | 前置条件           | 后置条件             |
| --------------------------------------- | ---------------------------------------- | -------------- | ---------------- |
| draftdataservice.DraftManagement.update | `public BillVO[] update()`               | 无。             | 获得当前用户已经保存的草稿。   |
| draftdataservice.DraftManagement.delete | `public ResultMessage delete(BillVO bill)` | 选择的单据有效并状态是草稿。 | 将草稿删除，持久化信息已经保存。 |

## 6. 信息视角

### 6.1 数据持久化对象

系统的PO类就是对应的相关的实体类。

```java
class InvetoryStaffPO extends EmployeePO {
}
```

```java
class CommodityPO {//商品
  String ID;//型号+名称生成
  String name;
  String type;
  double amount;
  Date productionDate;//生产日期
  String batch;//批次
  String batchNo;//批号
  double purchasePrice;//进价
  double recentPurchasePrice;//最近进价
  double retailPrice;//售价
  double recentRetailPrice;//最近售价
  double warningValue;//警戒值
}
```


```java
class CommoditySortPO{//商品分类
  String ID;
  String name;
  String []commodityIDList;
  String preID;//父类
  String[] nextID; //子类
}
```
```java
class InventoryDetailBillPO extends InventoryBillPO{//报损报溢报警
  String ID;//单据编号
  String operatorID;//操作员编号
  String[] commodityIDList;//商品
  double[] amounts;//报损/报溢/报警数量
  Date time;
}
```

```java
enum InventoryBillType{
  Loss,Overflow,Warning//单据类型
}
```

```java
class InventoryBillPO extends BillPO{
  InventoryBillTypePO inventoryBillType;
}
```

```java
class InventoryPicturePO {
//名称，型号，库存数量，库存均价，批次，批号，出厂日期
  Date time;
  CommodityPO[] items;
}
```

```java
class InventoryViewPO {
  Date time;
  double inventoryAmount;//入库数量
  double inventoryMoney;//入库金额
  double outOfInventoryAmount;//出库数量
  double outOfInVentoryMoney;//出库金额
  double sum;//合计
  double inSoldPrice;//最近进价
  double outSoldPrice;//最近售价
}
```


```java
class InventoryGiftPO{
   Date time;
   String ID;
   PromotionCommodity[] gifts;
}
```

```java
class ClientPO {
    String id;
    ClientType clientType;
    int clientLevel;
    String name;
    String phone;
    String address;
    String zipCode;
    String email;
    double receivableQuota;
    double payableQuota;
    String defaultOperatorId;
}
```

```typescript
enum ClientType {
    Supplier,
    Retailer
}
```

```java
class SaleStaffPO extends EmployeePO {
    SaleStaffType saleStaffType;
}
```

```java
enum SaleStaffType {
    President,
    Staff
}
```

```java
class SaleBillBasePO extends BillPO {
    SaleBillType saleBillType;
}
```

```java
enum SaleBillType {
    Sale,
    SaleRefund
}
```

```java
class SaleBillPO extends SaleBillBasePO {
    String supplier;
    String defaultOperatorId;
    String operatorId;
    int repository;
    CommodityPO[] commodityList;
    double originTotal;
    double minusProfits;
    double token;
    double ultiTotal;
    String Comment;
}
```

```java
class SaleRefundBillPO extends SaleBillBasePO {
    String supplier;
    String defaultOperatorId;
    String operatorId;
    int repository;
    CommodityPO[] commodityList;
    double originTotal;
    double minusProfits;
    double token;
    double ultiTotal;
    String Comment;
}
```

```java
class PurchaseBillBasePO extends BillPO {
    PurchaseBillType purchaseBillType;
}
```

```java
enum PurchaseBillType {
    Purchase,
    PurchaseRefund
}
```

```java
class PurchaseBillPO extends PurchaseBillBasePO {
    String supplier;
    int repository;
    String operatorId;
    String Comment;
    double total;
    CommodityPO[] commodityList;
}
```

```java
class PurchaseRefundBillPO extends PurchaseBillBasePO {
    String supplier;
    int repository;
    String operatorId;
    String Comment;
    double total;
    CommodityPO[] commodityList;
}
```

```java
class FinancialStaffPO extends EmployeePO {  
}
```

```java
class BankAccountPO {
    String ID;
    String name;
    double amount;
    Date createTime;
}
```

```java
class FinancialBillPO extends BillPO {
    FinancialBillType financialBillType;
}
```

```java
class ReceivalPaymentBillPOBase extends FinancialBillPO {
    String ID; //收款单格式是SKD-yyyyMMDD-00001，付款单格式是FKD-yyyyMMDD-00001
    String clientID; 
    String operatorID;
    Transcation[] transcations;
    double total;
}
```

```java
enum FinancialBillType {
    ReceivalBill,
    PaymentBill,
    CashBill,
}
```

```java
class ReceivalBillPO extends ReceivalPaymentBillPOBase {
}
```

```java
class Transcation {
    String ID; //格式是FKDSKD-yyyyMMDD-ID-00001
    String accountID;
    double total;
    String comment;
}
```

```java
class PaymentBillPO extends ReceivalPaymentBillPOBase {
}
```

```java
class CashBillPO extends FinancialBillPO {
    String ID;//格式是XJFYD-yyyyMMDD-00001
    String operatorID;
    String accountID;
    CashBillItem[] items;
}
```

```java
class CashBillItem {
    String ID; //格式是XJFYDX-yyyyMMDD-XJFYDID-00001
    String name;
    double amount;
    String comment;
}
```

```java
class SystemSnapshotPO { //账
    //存储一次不修改
    CommodityVO[] commodities;
    ClientVO[] clients;
    BankAccountVO[] bankAccounts;
}
```

```java
class ManagerStaffPO{
  String ID;
  String name;
}
```

```java
class PromotionPOBase{
  String ID;
  PromotionType type;
  String startDate;
  String endDate; 
  PromotionState state;
}
```

```java
 enum PromotionType{
   CommodityOnSale,//组合商品降价
   TotalPriceGift,//满额赠送礼品
   TotalPriceCoupon,//满额赠送代金券
   ClientGift,//客户赠送礼品
   ClientCoupon,//客户赠送代金券
   ClientOnSale;//客户价格这让
}
```

```java
enum PromotionState{
   Draft,
   Waiting,
   Active,
   Overdue,
   Abondoned;
}
```

```java
class PromotionCommodity{
    String ID;
    String commodityID;
    double amout;
}
```

```java
class CommodityOnSalePO extends PromotionPOBase{
    PromotionCommodity[] commodityOnSale;
    double onSalePrice;
}
```

```java
class TotalPriceGiftPO extends PromotionPOBase{
    PromotionCommodity[] gifts;
    double totalPrice;
}
```

```java
class TotalPriceCouponPO extends PromotionPOBase{
    double couponPrice;
    double totalPrice;
}
```

```java
class ClientGiftPO extends PromotionPOBase{
    int clientLevel;
    PromotionCommodity[] gifts;
}
```

```java
class ClientCouponPO extends PromotionPOBase{
    int clientLevel;
    double couponPrice;
}
```

```java
class ClientOnSalePO extends PromotionPOBase{
    int clientLevel;
    double onSalePrice;
}
```

```java
class userStaffPO extends EmpolyeePO{
}
```

```java
class userAccountPO{
    String ID;
    String name;
    String accountName;
    String password;
    boolean hasRoot;
    AccountState state;
}
```

```java
enum AccountState{
    Using;
    Abondoned;
}
```

```java
class BillPO {
    BillType bill;
    String ID;
    Date date;
    BillState state;
}
```

```java
enum BillType {
    InventoryBill, //库存类单据
    StockBill, //进货类单据
    SaleBill, //销售类单据
    FinanceBill, //财务类单据

}
```

```java
enum BillState {
    Draft,
    WaitingForApproval,
    Rejected,
    Approved,
    Abandoned
}
```

```java
class EmployeePO {
    String name;
    String ID;
    Date workSince;
    String username;
    String password;
    EmployeePosition position;
}
```

```java
enum EmployeePosition{
    InventoryStaff,
    SaleStaff,
    FinanceStaff,
    Manager,
    Admin
}
```

```java
class NotificationPO {
    String ID;
    Date date;
    NotificationType type;
}
```

```java
enum NotificationType{
    BillApproval,
    Others
}
```

```java
class BillApprovalNotificationPO extends NotificationPO {
    String billID;
}
```

```java
class BillApprovalNotificationVO {
    String ID;
    Date date;
    NotificationType type;
    BillVO bill;
}
```

```java
class OtherNotificationPO extends NotificationPO {
    String content;
}
```

```java
class DraftPO {
    Date saveTime;
    String billID;
}
```

```java
class LogPO {
    Date date;
    LogSeverity severity;
    String content;
}
```

```java
enum LogSeverity{
    Info,
    Success,
    Warning,
    Failure
}
```

### 6.2 文件格式

保存到SQLite数据库。